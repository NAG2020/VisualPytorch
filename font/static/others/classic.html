<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="../../resources/templatesRes/img/favicon.ico">
    <!-- Place favicon.ico in the root directory -->
    <!-- Google Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Poppins:400,700,600,500,300' rel='stylesheet' type='text/css'>

    <!-- all css here -->
    <!-- bootstrap v3.3.6 css -->
    <link rel="stylesheet" href="https://www.jq22.com/jquery/bootstrap-3.3.4.css">
    <!-- animate css -->
    <link rel="stylesheet" href="../../resources/templatesRes/css/animate.css">
    <!-- jquery-ui.min css -->
    <link rel="stylesheet" href="../../resources/templatesRes/css/jquery-ui.min.css">
    <!-- meanmenu css -->
    <link rel="stylesheet" href="../../resources/templatesRes/css/meanmenu.min.css">
    <!-- Font-Awesome css -->
    <link rel="stylesheet" href="https://www.jq22.com/jquery/font-awesome.4.6.0.css">
    <!-- pe-icon-7-stroke css -->
    <link rel="stylesheet" href="../../resources/templatesRes/css/pe-icon-7-stroke.css">
    <!-- Flaticon css -->
    <link rel="stylesheet" href="../../resources/templatesRes/css/flaticon.css">
    <!-- venobox css -->
    <link rel="stylesheet" href="../../resources/templatesRes/venobox/venobox.css" type="text/css" media="screen"/>
    <!-- owl.carousel css -->
    <link rel="stylesheet" href="../../resources/templatesRes/css/owl.carousel.css">
    <!-- style css -->
    <link rel="stylesheet" href="../../resources/templatesRes/css/style.css">
    <!-- responsive css -->
    <link rel="stylesheet" href="../../resources/templatesRes/css/responsive.css">
    <!-- modernizr css -->
    <script src="../../resources/templatesRes/js/vendor/modernizr-2.8.3.min.js"></script>
    <!--原有head-->
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>classic models</title>
    <script type="text/javascript" src="../../resources/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="../../resources/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../resources/jquery-ui.js"></script>
    <link href="../../resources/bootstrap.min.css" rel="stylesheet">
    <link href="../../resources/jquery-ui.css" rel="stylesheet">
    <link href="../../resources/jquery-ui.structure.css" rel="stylesheet">
    <link href="../../resources/jquery-ui.theme.css" rel="stylesheet">
    <link href="../../css/layer.css" rel="stylesheet">
    <script type="text/javascript" src="../../javascript/base_service.js"></script>
    <script type="text/javascript" src="../../javascript/graph_action.js"></script>
    <link href="../../resources/bootstrap.min.css" rel="stylesheet">
    <link href="../../resources/jquery-ui.css" rel="stylesheet">
    <link href="../../resources/jquery-ui.structure.css" rel="stylesheet">
    <link href="../../resources/jquery-ui.theme.css" rel="stylesheet">
    <link href="../../css/buttons.css" rel="stylesheet">
    <link href="../../css/login.css" rel="stylesheet">
    <link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
        html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
        body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
        iframe { margin: auto; }
        a.url { word-break: break-all; }
        a:active, a:hover { outline: 0px; }
        .in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
        #write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
        #write.first-line-indent p { text-indent: 2em; }
        #write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
        #write.first-line-indent li { margin-left: 2em; }
        .for-image #write { padding-left: 8px; padding-right: 8px; }
        body.typora-export { padding-left: 30px; padding-right: 30px; }
        .typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
        @media screen and (max-width: 500px) {
          body.typora-export { padding-left: 0px; padding-right: 0px; }
          #write { padding-left: 20px; padding-right: 20px; }
          .CodeMirror-sizer { margin-left: 0px !important; }
          .CodeMirror-gutters { display: none !important; }
        }
        #write li > figure:last-child { margin-bottom: 0.5rem; }
        #write ol, #write ul { position: relative; }
        img { max-width: 100%; vertical-align: middle; }
        button, input, select, textarea { color: inherit; font: inherit; }
        input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
        *, ::after, ::before { box-sizing: border-box; }
        #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
        #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
        p { line-height: inherit; }
        h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
        p { orphans: 4; }
        h1 { font-size: 2rem; }
        h2 { font-size: 1.8rem; }
        h3 { font-size: 1.6rem; }
        h4 { font-size: 1.4rem; }
        h5 { font-size: 1.2rem; }
        h6 { font-size: 1rem; }
        .md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
        .hidden { display: none; }
        .md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
        a { cursor: pointer; }
        sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
        sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
        #write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
        figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
        figure > table { margin: 0px !important; }
        tr { break-inside: avoid; break-after: auto; }
        thead { display: table-header-group; }
        table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
        table.md-table td { min-width: 32px; }
        .CodeMirror-gutters { border-right: 0px; background-color: inherit; }
        .CodeMirror-linenumber { user-select: none; }
        .CodeMirror { text-align: left; }
        .CodeMirror-placeholder { opacity: 0.3; }
        .CodeMirror pre { padding: 0px 4px; }
        .CodeMirror-lines { padding: 0px; }
        div.hr:focus { cursor: none; }
        #write pre { white-space: pre-wrap; }
        #write.fences-no-line-wrapping pre { white-space: pre; }
        #write pre.ty-contain-cm { white-space: normal; }
        .CodeMirror-gutters { margin-right: 4px; }
        .md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
        .md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
        #write .md-fences.mock-cm { white-space: pre-wrap; }
        .md-fences.md-fences-with-lineno { padding-left: 0px; }
        #write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
        .md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
        .CodeMirror-line, twitterwidget { break-inside: avoid; }
        .footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
        .footnotes + .footnotes { margin-top: 0px; }
        .md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
        li div { padding-top: 0px; }
        blockquote { margin: 1rem 0px; }
        li .mathjax-block, li p { margin: 0.5rem 0px; }
        li { margin: 0px; position: relative; }
        blockquote > :last-child { margin-bottom: 0px; }
        blockquote > :first-child, li > :first-child { margin-top: 0px; }
        .footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
        #write .footnote-line { white-space: pre-wrap; }
        @media print {
          body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
          #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
          .typora-export * { -webkit-print-color-adjust: exact; }
          html.blink-to-pdf { font-size: 13px; }
          .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
          .typora-export #write::after { height: 0px; }
        }
        .footnote-line { margin-top: 0.714em; font-size: 0.7em; }
        a img, img a { cursor: pointer; }
        pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
        p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
        p > .md-image:only-child { display: inline-block; width: 100%; }
        #write .MathJax_Display { margin: 0.8em 0px 0px; }
        .md-math-block { width: 100%; }
        .md-math-block:not(:empty)::after { display: none; }
        [contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
        .md-task-list-item { position: relative; list-style-type: none; }
        .task-list-item.md-task-list-item { padding-left: 0px; }
        .md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
        .math { font-size: 1rem; }
        .md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
        .md-toc-content { position: relative; margin-left: 0px; }
        .md-toc-content::after, .md-toc::after { display: none; }
        .md-toc-item { display: block; color: rgb(65, 131, 196); }
        .md-toc-item a { text-decoration: none; }
        .md-toc-inner:hover { text-decoration: underline; }
        .md-toc-inner { display: inline-block; cursor: pointer; }
        .md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
        .md-toc-h2 .md-toc-inner { margin-left: 2em; }
        .md-toc-h3 .md-toc-inner { margin-left: 4em; }
        .md-toc-h4 .md-toc-inner { margin-left: 6em; }
        .md-toc-h5 .md-toc-inner { margin-left: 8em; }
        .md-toc-h6 .md-toc-inner { margin-left: 10em; }
        @media screen and (max-width: 48em) {
          .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
          .md-toc-h4 .md-toc-inner { margin-left: 5em; }
          .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
          .md-toc-h6 .md-toc-inner { margin-left: 8em; }
        }
        a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
        .footnote-line a:not(.reversefootnote) { color: inherit; }
        .md-attr { display: none; }
        .md-fn-count::after { content: "."; }
        code, pre, samp, tt { font-family: var(--monospace); }
        kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
        .md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
        code { text-align: left; vertical-align: initial; }
        a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
        .md-inline-math .MathJax_SVG .noError { display: none !important; }
        .html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
        .md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
        .MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
        .MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
        .MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
        .MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
        .MathJax_SVG * { transition: none 0s ease 0s; }
        .MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
        .os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
        .md-diagram-panel > svg { max-width: 100%; }
        [lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
        [lang="mermaid"] .node text { font-size: 1rem; }
        table tr th { border-bottom: 0px; }
        video { max-width: 100%; display: block; margin: 0px auto; }
        iframe { max-width: 100%; width: 100%; border: none; }
        .highlight td, .highlight tr { border: 0px; }
        svg[id^="mermaidChart"] { line-height: 1em; }
        mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
        .md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
        mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }
        
        
        .CodeMirror { height: auto; }
        .CodeMirror.cm-s-inner { background: inherit; }
        .CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
        .CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
        .CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
        .CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
        .cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
        .cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
        .cm-s-inner .cm-number { color: rgb(17, 102, 68); }
        .cm-s-inner .cm-def { color: rgb(0, 0, 255); }
        .cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
        .cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
        .cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
        .cm-s-inner .cm-string { color: rgb(170, 17, 17); }
        .cm-s-inner .cm-property { color: rgb(0, 0, 0); }
        .cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
        .cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
        .cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
        .cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
        .cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
        .cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
        .cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
        .cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
        .cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
        .cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
        .cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
        .cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
        .cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
        .cm-negative { color: rgb(221, 68, 68); }
        .cm-positive { color: rgb(34, 153, 34); }
        .cm-header, .cm-strong { font-weight: 700; }
        .cm-del { text-decoration: line-through; }
        .cm-em { font-style: italic; }
        .cm-link { text-decoration: underline; }
        .cm-error { color: red; }
        .cm-invalidchar { color: red; }
        .cm-constant { color: rgb(38, 139, 210); }
        .cm-defined { color: rgb(181, 137, 0); }
        div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
        div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
        .cm-s-inner .CodeMirror-activeline-background { background: inherit; }
        .CodeMirror { position: relative; overflow: hidden; }
        .CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
        .CodeMirror-sizer { position: relative; }
        .CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
        .CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
        .CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
        .CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
        .CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
        .CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
        .CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
        .CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
        .CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
        .CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
        .CodeMirror-lines { cursor: text; }
        .CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
        .CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
        .CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
        .CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
        .CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
        .CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
        .CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
        .CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
        .CodeMirror-measure pre { position: static; }
        .CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
        .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
        .CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
        .cm-searching { background: rgba(255, 255, 0, 0.4); }
        @media print {
          .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
        }
        
        
        :root {
            --side-bar-bg-color: #fafafa;
            --control-text-color: #777;
        }
        
        @include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);
        
        html {
            font-size: 16px;
        }
        
        body {
            font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
            color: rgb(51, 51, 51);
            line-height: 1.6;
        }
        
        #write {
            max-width: 860px;
              margin: 0 auto;
              padding: 30px;
            padding-bottom: 100px;
        }
        #write > ul:first-child,
        #write > ol:first-child{
            margin-top: 30px;
        }
        
        a {
            color: #4183C4;
        }
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            position: relative;
            margin-top: 1rem;
            margin-bottom: 1rem;
            font-weight: bold;
            line-height: 1.4;
            cursor: text;
        }
        h1:hover a.anchor,
        h2:hover a.anchor,
        h3:hover a.anchor,
        h4:hover a.anchor,
        h5:hover a.anchor,
        h6:hover a.anchor {
            text-decoration: none;
        }
        h1 tt,
        h1 code {
            font-size: inherit;
        }
        h2 tt,
        h2 code {
            font-size: inherit;
        }
        h3 tt,
        h3 code {
            font-size: inherit;
        }
        h4 tt,
        h4 code {
            font-size: inherit;
        }
        h5 tt,
        h5 code {
            font-size: inherit;
        }
        h6 tt,
        h6 code {
            font-size: inherit;
        }
        h1 {
            padding-bottom: .3em;
            font-size: 2.25em;
            line-height: 1.2;
            border-bottom: 1px solid #eee;
        }
        h2 {
           padding-bottom: .3em;
            font-size: 1.75em;
            line-height: 1.225;
            border-bottom: 1px solid #eee;
        }
        h3 {
            font-size: 1.5em;
            line-height: 1.43;
        }
        h4 {
            font-size: 1.25em;
        }
        h5 {
            font-size: 1em;
        }
        h6 {
           font-size: 1em;
            color: #777;
        }
        p,
        blockquote,
        ul,
        ol,
        dl,
        table{
            margin: 0.8em 0;
        }
        li>ol,
        li>ul {
            margin: 0 0;
        }
        hr {
            height: 2px;
            padding: 0;
            margin: 16px 0;
            background-color: #e7e7e7;
            border: 0 none;
            overflow: hidden;
            box-sizing: content-box;
        }
        
        li p.first {
            display: inline-block;
        }
        ul,
        ol {
            padding-left: 30px;
        }
        ul:first-child,
        ol:first-child {
            margin-top: 0;
        }
        ul:last-child,
        ol:last-child {
            margin-bottom: 0;
        }
        blockquote {
            border-left: 4px solid #dfe2e5;
            padding: 0 15px;
            color: #777777;
        }
        blockquote blockquote {
            padding-right: 0;
        }
        table {
            padding: 0;
            word-break: initial;
        }
        table tr {
            border-top: 1px solid #dfe2e5;
            margin: 0;
            padding: 0;
        }
        table tr:nth-child(2n),
        thead {
            background-color: #f8f8f8;
        }
        table tr th {
            font-weight: bold;
            border: 1px solid #dfe2e5;
            border-bottom: 0;
            margin: 0;
            padding: 6px 13px;
        }
        table tr td {
            border: 1px solid #dfe2e5;
            margin: 0;
            padding: 6px 13px;
        }
        table tr th:first-child,
        table tr td:first-child {
            margin-top: 0;
        }
        table tr th:last-child,
        table tr td:last-child {
            margin-bottom: 0;
        }
        
        .CodeMirror-lines {
            padding-left: 4px;
        }
        
        .code-tooltip {
            box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
            border-top: 1px solid #eef2f2;
        }
        
        .md-fences,
        code,
        tt {
            border: 1px solid #e7eaed;
            background-color: #f8f8f8;
            border-radius: 3px;
            padding: 0;
            padding: 2px 4px 0px 4px;
            font-size: 0.9em;
        }
        
        code {
            background-color: #f3f4f4;
            padding: 0 2px 0 2px;
        }
        
        .md-fences {
            margin-bottom: 15px;
            margin-top: 15px;
            padding-top: 8px;
            padding-bottom: 6px;
        }
        
        
        .md-task-list-item > input {
          margin-left: -1.3em;
        }
        
        @media print {
            html {
                font-size: 13px;
            }
            table,
            pre {
                page-break-inside: avoid;
            }
            pre {
                word-wrap: break-word;
            }
        }
        
        .md-fences {
            background-color: #f8f8f8;
        }
        #write pre.md-meta-block {
            padding: 1rem;
            font-size: 85%;
            line-height: 1.45;
            background-color: #f7f7f7;
            border: 0;
            border-radius: 3px;
            color: #777777;
            margin-top: 0 !important;
        }
        
        .mathjax-block>.code-tooltip {
            bottom: .375rem;
        }
        
        .md-mathjax-midline {
            background: #fafafa;
        }
        
        #write>h3.md-focus:before{
            left: -1.5625rem;
            top: .375rem;
        }
        #write>h4.md-focus:before{
            left: -1.5625rem;
            top: .285714286rem;
        }
        #write>h5.md-focus:before{
            left: -1.5625rem;
            top: .285714286rem;
        }
        #write>h6.md-focus:before{
            left: -1.5625rem;
            top: .285714286rem;
        }
        .md-image>.md-meta {
            /*border: 1px solid #ddd;*/
            border-radius: 3px;
            padding: 2px 0px 0px 4px;
            font-size: 0.9em;
            color: inherit;
        }
        
        .md-tag {
            color: #a7a7a7;
            opacity: 1;
        }
        
        .md-toc { 
            margin-top:20px;
            padding-bottom:20px;
        }
        
        .sidebar-tabs {
            border-bottom: none;
        }
        
        #typora-quick-open {
            border: 1px solid #ddd;
            background-color: #f8f8f8;
        }
        
        #typora-quick-open-item {
            background-color: #FAFAFA;
            border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
            border-style: solid;
            border-width: 1px;
        }
        
        /** focus mode */
        .on-focus-mode blockquote {
            border-left-color: rgba(85, 85, 85, 0.12);
        }
        
        header, .context-menu, .megamenu-content, footer{
            font-family: "Segoe UI", "Arial", sans-serif;
        }
        
        .file-node-content:hover .file-node-icon,
        .file-node-content:hover .file-node-open-state{
            visibility: visible;
        }
        
        .mac-seamless-mode #typora-sidebar {
            background-color: #fafafa;
            background-color: var(--side-bar-bg-color);
        }
        
        .md-lang {
            color: #b4654d;
        }
        
        .html-for-mac .context-menu {
            --item-hover-bg-color: #E6F0FE;
        }
        
        #md-notification .btn {
            border: 0;
        }
        
        .dropdown-menu .divider {
            border-color: #e5e5e5;
        }
        
        .ty-preferences .window-content {
            background-color: #fafafa;
        }
        
        .ty-preferences .nav-group-item.active {
            color: white;
            background: #999;
        }
        
         .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
        </style>

    <style>

        #doc-sidebar > .nav > li > a, #doc-sidebar > .nav > li > .nav > li > a,
        #doc-sidebar > .nav > li > .nav > li > .nav > li > a,
        #doc-sidebar > .nav > li > .nav > li > .nav > li > .nav > li > a {
            position: relative;
            display: block;
            padding: 0px 15px;
            height: 20px;
            color: #3e3e3e;
        }


        #doc-sidebar > .nav > li {
            /*border: 1px solid #d4d4d4;*/
            border: none;
        }

        /*
            一级菜单显示
        */
        #doc-sidebar > .nav > .active > a {
            color: #259ade;
            border: none;
            border-left: 5px solid #00a4ff;
        }

        /*
        默认未激活的二级菜单折叠
        */
        #doc-sidebar > .nav > li > .nav {
            display: none;
        }

        /*
        激活的二级菜单展示
        */
        #doc-sidebar > .nav > .active > .nav {
            display: block;
            margin-left: 20px;
        }

        /*
        二级菜单的样式
        */
        #doc-sidebar > .nav > .active > .nav > .active > a {
            color: #259ade;
            border-left: 5px solid #00a4ff;
        }

        /*
		默认未激活的三级菜单折叠
		*/
        #doc-sidebar > .nav > li > .nav > li > .nav {
            display: none;
        }

        /*
        激活的三级菜单展示
        */
        #doc-sidebar > .nav > .active > .nav > .active > .nav {
            display: block;
            margin-left: 20px;
        }

        /*
		三级菜单的样式
		*/
        #doc-sidebar > .nav > .active > .nav > .active > .nav > .active > a {
            color: #259ade;
            border-left: 5px solid #00a4ff;
        }

        /*
		默认未激活的四级菜单折叠
		*/
        #doc-sidebar > .nav > li > .nav > li > .nav > li > .nav {
            display: none;
        }

        /*
        激活的四级菜单展示
        */
        #doc-sidebar > .nav > .active > .nav > .active > .nav > .active > .nav {
            display: block;
            margin-left: 20px;
        }

        /*
		四级菜单的样式
		*/
        #doc-sidebar > .nav > .active > .nav > .active > .nav > .active > .nav > .active > a {
            color: #259ade;
            border-left: 5px solid #00a4ff;
        }

        .nav-tabs {
            border: none
        }

        .left-div {
        height: 100%; /*目录框的高度*/
        float:left;/*目录框的位置*/
        overflow-y:scroll;/*目录框添加滚动条*/
        padding-right: 10px;
        position: fixed;/*目录框相对浏览器进行定位*/
        width:17%;/*目录框的宽度*/
        }

    </style>

    <script type="text/javascript">
        $(document).ready(function () {
            // $("#header_index").attr("href", "index.html");
            // $("#header_create_models").attr("href", "models/create_models.html");
            // $("#header_manage_models").attr("href", "models/manage_models.html");
            // $("#header_model_market").attr("href", "models/model_market.html");

            // $("#header_help1").attr("href", "help.html");
            // $("#header_help2").attr("href", "help.html");
            // $("#header_about").attr("href", "feedback/about.html");

            // $("#header_statistics").attr("href", "statistics.html");
            // $("#header_feedback").attr("href", "feedback/feedback.html");
            // //css
            // $("#css1").attr("src", "../../resources/bootstrap.min.css");
            // $("#css2").attr("src", "../../resources/jquery-ui.css");
            // $("#css3").attr("src", "../../resources/jquery-ui.structure.css");
            // $("#css4").attr("src", "../../resources/jquery-ui.theme.css");
            // $("#css5").attr("src", "../../css/buttons.css");
            // $("#css6").attr("src", "../../css/login.css");
            // //js
            // $("#js1").attr("src", "../../resources/jquery-3.3.1.js");
            // $("#js2").attr("src", "../../resources/bootstrap.min.js");
            // $("#js3").attr("src", "../../resources/jquery-ui.js");
            // $("#js4").attr("src", "../../javascript/graph_action.js");
            // $("#js5").attr("src", "../../javascript/base_service.js");

            $("#png1").attr("src", "../../resources/templatesRes/img/logo.png");
            $("#png2").attr("src", "../../resources/templatesRes/img/logo-2.png");
            $("#png3").attr("src", "../../resources/templatesRes/img/paypal.png");
            $("#login_pic_1").attr("src", "../../img/person.png");
            $("#login_pic_2").attr("src", "../../img/lock.png");
            $("#reg_pic_1").attr("src", "../../img/person.png");
            $("#reg_pic_2").attr("src", "../../img/lock.png");
            $("#reg_pic_3").attr("src", "../../img/lock.png");
            $("#reg_pic_4").attr("src", "../../img/e-mail.png");

        });
    </script>
    
</head>

<body class='typora-export os-windows' >
    <div class='md-toc left-div' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n134"><a class="md-toc-inner" href="#经典网络层模型">经典网络层模型</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n3"><a class="md-toc-inner" href="#alexnet">AlexNet</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n28"><a class="md-toc-inner" href="#resnet">ResNet</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n38"><a class="md-toc-inner" href="#densenet">DenseNet</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n47"><a class="md-toc-inner" href="#googlenet">GoogleNet</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n59"><a class="md-toc-inner" href="#vggnet">VggNet</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n67"><a class="md-toc-inner" href="#shufflenet">ShuffleNet</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n78"><a class="md-toc-inner" href="#教学模型">教学模型</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n79"><a class="md-toc-inner" href="#mnist预测模型"><strong>mnist预测模型</strong> </a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n80"><a class="md-toc-inner" href="#mnist数据集介绍">mnist数据集介绍</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n82"><a class="md-toc-inner" href="#mnistmodel1"><strong>mnist_model1</strong></a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n96"><a class="md-toc-inner" href="#mnistmodel2"><strong>mnist_model2</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n107"><a class="md-toc-inner" href="#cifar10预测模型">cifar10预测模型</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n108"><a class="md-toc-inner" href="#cifar10数据集介绍">cifar10数据集介绍</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n112"><a class="md-toc-inner" href="#cifar10model1">cifar10_model1</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n123"><a class="md-toc-inner" href="#cifar10model2">cifar10_model2</a></span></p></div>
    <div id="header">
    </div>
    <p>&nbsp;</p>
    <div  id='write'  class = 'is-node first-line-indent'>
        <p>&nbsp;</p><h2><a name="经典网络层模型" class="md-header-anchor"></a><span>经典网络层模型</span></h2><h3><a name="alexnet" class="md-header-anchor"></a><span>AlexNet</span></h3><p><strong><span>模型链接:</span></strong></p><p><strong><span>模型下载链接:</span></strong></p><p><strong><span>模型介绍:</span></strong></p><p><span>Alex Krizhevsky等人在2012年提出了AlexNe 并应用在大尺寸图片数据集ImageNet上，获得了2012年ImageNet比赛冠军。</span></p><p><span>AlexNet在LeNet的基础上加深了网络的结构，学习更丰富更高维的图像特征。AlexNet的特点：</span></p><ul><li><span>更深的网络结构</span></li><li><span>使用层叠的卷积层，即卷积层+卷积层+池化层来提取图像的特征</span></li><li><span>使用Dropout抑制过拟合</span></li><li><span>使用数据增强Data Augmentation抑制过拟合</span></li><li><span>使用Relu替换之前的sigmoid的作为激活函数</span></li><li><span>多GPU训练</span></li></ul><p><strong><span>网络层大致结构:</span></strong></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144458626-1632051742.png" referrerpolicy="no-referrer"></p><p><strong><span>论文中的网络结构:</span></strong></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144520454-2098800520.png" referrerpolicy="no-referrer"></p><p><strong><span>pytorch实现代码：</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">AlexNet</span>(<span class="cm-variable">nn</span>.<span class="cm-property">Module</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">num_classes</span>=<span class="cm-number">1000</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">super</span>(<span class="cm-variable">AlexNet</span>, <span class="cm-variable-2">self</span>).<span class="cm-property">__init__</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">features</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Sequential</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">3</span>, <span class="cm-number">64</span>, <span class="cm-variable">kernel_size</span>=<span class="cm-number">11</span>, <span class="cm-variable">stride</span>=<span class="cm-number">4</span>, <span class="cm-variable">padding</span>=<span class="cm-number">2</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-variable">inplace</span>=<span class="cm-keyword">True</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">MaxPool2d</span>(<span class="cm-variable">kernel_size</span>=<span class="cm-number">3</span>, <span class="cm-variable">stride</span>=<span class="cm-number">2</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">64</span>, <span class="cm-number">192</span>, <span class="cm-variable">kernel_size</span>=<span class="cm-number">5</span>, <span class="cm-variable">padding</span>=<span class="cm-number">2</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-variable">inplace</span>=<span class="cm-keyword">True</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">MaxPool2d</span>(<span class="cm-variable">kernel_size</span>=<span class="cm-number">3</span>, <span class="cm-variable">stride</span>=<span class="cm-number">2</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">192</span>, <span class="cm-number">384</span>, <span class="cm-variable">kernel_size</span>=<span class="cm-number">3</span>, <span class="cm-variable">padding</span>=<span class="cm-number">1</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-variable">inplace</span>=<span class="cm-keyword">True</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">384</span>, <span class="cm-number">256</span>, <span class="cm-variable">kernel_size</span>=<span class="cm-number">3</span>, <span class="cm-variable">padding</span>=<span class="cm-number">1</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-variable">inplace</span>=<span class="cm-keyword">True</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">256</span>, <span class="cm-number">256</span>, <span class="cm-variable">kernel_size</span>=<span class="cm-number">3</span>, <span class="cm-variable">padding</span>=<span class="cm-number">1</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-variable">inplace</span>=<span class="cm-keyword">True</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">MaxPool2d</span>(<span class="cm-variable">kernel_size</span>=<span class="cm-number">3</span>, <span class="cm-variable">stride</span>=<span class="cm-number">2</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">avgpool</span> = <span class="cm-variable">nn</span>.<span class="cm-property">AdaptiveAvgPool2d</span>((<span class="cm-number">6</span>, <span class="cm-number">6</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">classifier</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Sequential</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Dropout</span>(),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">256</span> <span class="cm-operator">*</span> <span class="cm-number">6</span> <span class="cm-operator">*</span> <span class="cm-number">6</span>, <span class="cm-number">4096</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-variable">inplace</span>=<span class="cm-keyword">True</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Dropout</span>(),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">4096</span>, <span class="cm-number">4096</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-variable">inplace</span>=<span class="cm-keyword">True</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">4096</span>, <span class="cm-variable">num_classes</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">forward</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">features</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">avgpool</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable">torch</span>.<span class="cm-property">flatten</span>(<span class="cm-variable">x</span>, <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">classifier</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">x</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 829px;"></div><div class="CodeMirror-gutters" style="display: none; height: 829px;"></div></div></div></pre><h3><a name="resnet" class="md-header-anchor"></a><span>ResNet</span></h3><p><strong><span>模型下载链接:</span></strong></p><p><strong><span>模型介绍:</span></strong></p><p><span>Residual Network,简称 ResNet(残差网络)，是MSRA 何凯明团队设计的一种网络架构，在2015年的ILSVRC 和 COCO 上拿到了多项冠军，其发表的论文Deep Residual Learning for Image Recognition, 是 CVPR 2016的最佳论文。残差网络的特点是容易优化，并且能够通过增加相当的深度来提高准确率。其内部的残差块使用了跳跃连接，缓解了在深度神经网络中增加深度带来的梯度消失问题 。</span></p><p><span>内部残差块结构：</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144539214-557309236.png" referrerpolicy="no-referrer"></p><p><span>网络层大致结构:</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144553787-1703059693.png" referrerpolicy="no-referrer"></p><p><span>pytorch实现代码：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ResNet</span>(<span class="cm-variable">nn</span>.<span class="cm-property">Module</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">block</span>, <span class="cm-variable">layers</span>, <span class="cm-variable">num_classes</span>=<span class="cm-number">1000</span>, <span class="cm-variable">zero_init_residual</span>=<span class="cm-keyword">False</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">groups</span>=<span class="cm-number">1</span>, <span class="cm-variable">width_per_group</span>=<span class="cm-number">64</span>, <span class="cm-variable">replace_stride_with_dilation</span>=<span class="cm-keyword">None</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">norm_layer</span>=<span class="cm-keyword">None</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">super</span>(<span class="cm-variable">ResNet</span>, <span class="cm-variable-2">self</span>).<span class="cm-property">__init__</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">norm_layer</span> <span class="cm-keyword">is</span> <span class="cm-keyword">None</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">norm_layer</span> = <span class="cm-variable">nn</span>.<span class="cm-property">BatchNorm2d</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">_norm_layer</span> = <span class="cm-variable">norm_layer</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">inplanes</span> = <span class="cm-number">64</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">dilation</span> = <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">replace_stride_with_dilation</span> <span class="cm-keyword">is</span> <span class="cm-keyword">None</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># each element in the tuple indicates if we should replace</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># the 2x2 stride with a dilated convolution instead</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">replace_stride_with_dilation</span> = [<span class="cm-keyword">False</span>, <span class="cm-keyword">False</span>, <span class="cm-keyword">False</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-builtin">len</span>(<span class="cm-variable">replace_stride_with_dilation</span>) <span class="cm-operator">!</span>= <span class="cm-number">3</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">raise</span> <span class="cm-variable">ValueError</span>(<span class="cm-string">"replace_stride_with_dilation should be None "</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"or a 3-element tuple, got {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">replace_stride_with_dilation</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">groups</span> = <span class="cm-variable">groups</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">base_width</span> = <span class="cm-variable">width_per_group</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">3</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">inplanes</span>, <span class="cm-variable">kernel_size</span>=<span class="cm-number">7</span>, <span class="cm-variable">stride</span>=<span class="cm-number">2</span>, <span class="cm-variable">padding</span>=<span class="cm-number">3</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">bias</span>=<span class="cm-keyword">False</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">bn1</span> = <span class="cm-variable">norm_layer</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">inplanes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">relu</span> = <span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-variable">inplace</span>=<span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">maxpool</span> = <span class="cm-variable">nn</span>.<span class="cm-property">MaxPool2d</span>(<span class="cm-variable">kernel_size</span>=<span class="cm-number">3</span>, <span class="cm-variable">stride</span>=<span class="cm-number">2</span>, <span class="cm-variable">padding</span>=<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">layer1</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">_make_layer</span>(<span class="cm-variable">block</span>, <span class="cm-number">64</span>, <span class="cm-variable">layers</span>[<span class="cm-number">0</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">layer2</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">_make_layer</span>(<span class="cm-variable">block</span>, <span class="cm-number">128</span>, <span class="cm-variable">layers</span>[<span class="cm-number">1</span>], <span class="cm-variable">stride</span>=<span class="cm-number">2</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">dilate</span>=<span class="cm-variable">replace_stride_with_dilation</span>[<span class="cm-number">0</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">layer3</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">_make_layer</span>(<span class="cm-variable">block</span>, <span class="cm-number">256</span>, <span class="cm-variable">layers</span>[<span class="cm-number">2</span>], <span class="cm-variable">stride</span>=<span class="cm-number">2</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">dilate</span>=<span class="cm-variable">replace_stride_with_dilation</span>[<span class="cm-number">1</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">layer4</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">_make_layer</span>(<span class="cm-variable">block</span>, <span class="cm-number">512</span>, <span class="cm-variable">layers</span>[<span class="cm-number">3</span>], <span class="cm-variable">stride</span>=<span class="cm-number">2</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">dilate</span>=<span class="cm-variable">replace_stride_with_dilation</span>[<span class="cm-number">2</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">avgpool</span> = <span class="cm-variable">nn</span>.<span class="cm-property">AdaptiveAvgPool2d</span>((<span class="cm-number">1</span>, <span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">fc</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">512</span> <span class="cm-operator">*</span> <span class="cm-variable">block</span>.<span class="cm-property">expansion</span>, <span class="cm-variable">num_classes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">m</span> <span class="cm-keyword">in</span> <span class="cm-variable-2">self</span>.<span class="cm-property">modules</span>():</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-builtin">isinstance</span>(<span class="cm-variable">m</span>, <span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">init</span>.<span class="cm-property">kaiming_normal_</span>(<span class="cm-variable">m</span>.<span class="cm-property">weight</span>, <span class="cm-variable">mode</span>=<span class="cm-string">'fan_out'</span>, <span class="cm-variable">nonlinearity</span>=<span class="cm-string">'relu'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">elif</span> <span class="cm-builtin">isinstance</span>(<span class="cm-variable">m</span>, (<span class="cm-variable">nn</span>.<span class="cm-property">BatchNorm2d</span>, <span class="cm-variable">nn</span>.<span class="cm-property">GroupNorm</span>)):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">init</span>.<span class="cm-property">constant_</span>(<span class="cm-variable">m</span>.<span class="cm-property">weight</span>, <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">init</span>.<span class="cm-property">constant_</span>(<span class="cm-variable">m</span>.<span class="cm-property">bias</span>, <span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># Zero-initialize the last BN in each residual branch,</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># so that the residual branch starts with zeros, and each residual block behaves like an identity.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># This improves the model by 0.2~0.3% according to https://arxiv.org/abs/1706.02677</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">zero_init_residual</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">m</span> <span class="cm-keyword">in</span> <span class="cm-variable-2">self</span>.<span class="cm-property">modules</span>():</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-builtin">isinstance</span>(<span class="cm-variable">m</span>, <span class="cm-variable">Bottleneck</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">init</span>.<span class="cm-property">constant_</span>(<span class="cm-variable">m</span>.<span class="cm-property">bn3</span>.<span class="cm-property">weight</span>, <span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">elif</span> <span class="cm-builtin">isinstance</span>(<span class="cm-variable">m</span>, <span class="cm-variable">BasicBlock</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">init</span>.<span class="cm-property">constant_</span>(<span class="cm-variable">m</span>.<span class="cm-property">bn2</span>.<span class="cm-property">weight</span>, <span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">_make_layer</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">block</span>, <span class="cm-variable">planes</span>, <span class="cm-variable">blocks</span>, <span class="cm-variable">stride</span>=<span class="cm-number">1</span>, <span class="cm-variable">dilate</span>=<span class="cm-keyword">False</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">norm_layer</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">_norm_layer</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">downsample</span> = <span class="cm-keyword">None</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">previous_dilation</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">dilation</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">dilate</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">dilation</span> *= <span class="cm-variable">stride</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stride</span> = <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">stride</span> <span class="cm-operator">!</span>= <span class="cm-number">1</span> <span class="cm-keyword">or</span> <span class="cm-variable-2">self</span>.<span class="cm-property">inplanes</span> <span class="cm-operator">!</span>= <span class="cm-variable">planes</span> <span class="cm-operator">*</span> <span class="cm-variable">block</span>.<span class="cm-property">expansion</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">downsample</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Sequential</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">conv1x1</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">inplanes</span>, <span class="cm-variable">planes</span> <span class="cm-operator">*</span> <span class="cm-variable">block</span>.<span class="cm-property">expansion</span>, <span class="cm-variable">stride</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">norm_layer</span>(<span class="cm-variable">planes</span> <span class="cm-operator">*</span> <span class="cm-variable">block</span>.<span class="cm-property">expansion</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">layers</span> = []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">layers</span>.<span class="cm-property">append</span>(<span class="cm-variable">block</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">inplanes</span>, <span class="cm-variable">planes</span>, <span class="cm-variable">stride</span>, <span class="cm-variable">downsample</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">groups</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">base_width</span>, <span class="cm-variable">previous_dilation</span>, <span class="cm-variable">norm_layer</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">inplanes</span> = <span class="cm-variable">planes</span> <span class="cm-operator">*</span> <span class="cm-variable">block</span>.<span class="cm-property">expansion</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">_</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">1</span>, <span class="cm-variable">blocks</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">layers</span>.<span class="cm-property">append</span>(<span class="cm-variable">block</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">inplanes</span>, <span class="cm-variable">planes</span>, <span class="cm-variable">groups</span>=<span class="cm-variable-2">self</span>.<span class="cm-property">groups</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">base_width</span>=<span class="cm-variable-2">self</span>.<span class="cm-property">base_width</span>, <span class="cm-variable">dilation</span>=<span class="cm-variable-2">self</span>.<span class="cm-property">dilation</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">norm_layer</span>=<span class="cm-variable">norm_layer</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">nn</span>.<span class="cm-property">Sequential</span>(<span class="cm-operator">*</span><span class="cm-variable">layers</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">_forward_impl</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># See note [TorchScript super()]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">bn1</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">relu</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">maxpool</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">layer1</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">layer2</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">layer3</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">layer4</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">avgpool</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable">torch</span>.<span class="cm-property">flatten</span>(<span class="cm-variable">x</span>, <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">fc</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">x</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">forward</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable-2">self</span>.<span class="cm-property">_forward_impl</span>(<span class="cm-variable">x</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 2240px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2240px;"></div></div></div></pre><h3><a name="densenet" class="md-header-anchor"></a><span>DenseNet</span></h3><p><strong><span>模型下载链接:</span></strong></p><p><strong><span>模型介绍:</span></strong></p><p><span>DenseNet模型的基本思路与ResNet一致，但是它建立的是前面所有层与后面层的密集连接（dense connection），它的名称也是由此而来。DenseNet的另一大特色是通过特征在channel上的连接来实现特征重用（feature reuse）。这些特点让DenseNet在参数和计算成本更少的情形下实现比ResNet更优的性能，DenseNet也因此斩获CVPR 2017的最佳论文奖。</span></p><p><span>模型大致结构:</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144615112-1911446431.png" referrerpolicy="no-referrer"></p><p><span>该架构与ResNet相比，在将特性传递到层之前，没有通过求和来组合特性，而是通过连接它们的方式来组合特性。因此第x层（输入层不算在内）将有x个输入，这些输入是之前所有层提取出的特征信息。</span></p><p><strong><span>pytorch实现代码:</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">_DenseLayer</span>(<span class="cm-variable">nn</span>.<span class="cm-property">Module</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">num_input_features</span>, <span class="cm-variable">growth_rate</span>, <span class="cm-variable">bn_size</span>, <span class="cm-variable">drop_rate</span>, <span class="cm-variable">memory_efficient</span>=<span class="cm-keyword">False</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">super</span>(<span class="cm-variable">_DenseLayer</span>, <span class="cm-variable-2">self</span>).<span class="cm-property">__init__</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">add_module</span>(<span class="cm-string">'norm1'</span>, <span class="cm-variable">nn</span>.<span class="cm-property">BatchNorm2d</span>(<span class="cm-variable">num_input_features</span>)),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">add_module</span>(<span class="cm-string">'relu1'</span>, <span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-variable">inplace</span>=<span class="cm-keyword">True</span>)),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">add_module</span>(<span class="cm-string">'conv1'</span>, <span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-variable">num_input_features</span>, <span class="cm-variable">bn_size</span> <span class="cm-operator">*</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">growth_rate</span>, <span class="cm-variable">kernel_size</span>=<span class="cm-number">1</span>, <span class="cm-variable">stride</span>=<span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">bias</span>=<span class="cm-keyword">False</span>)),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">add_module</span>(<span class="cm-string">'norm2'</span>, <span class="cm-variable">nn</span>.<span class="cm-property">BatchNorm2d</span>(<span class="cm-variable">bn_size</span> <span class="cm-operator">*</span> <span class="cm-variable">growth_rate</span>)),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">add_module</span>(<span class="cm-string">'relu2'</span>, <span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-variable">inplace</span>=<span class="cm-keyword">True</span>)),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">add_module</span>(<span class="cm-string">'conv2'</span>, <span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-variable">bn_size</span> <span class="cm-operator">*</span> <span class="cm-variable">growth_rate</span>, <span class="cm-variable">growth_rate</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">kernel_size</span>=<span class="cm-number">3</span>, <span class="cm-variable">stride</span>=<span class="cm-number">1</span>, <span class="cm-variable">padding</span>=<span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">bias</span>=<span class="cm-keyword">False</span>)),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">drop_rate</span> = <span class="cm-builtin">float</span>(<span class="cm-variable">drop_rate</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">memory_efficient</span> = <span class="cm-variable">memory_efficient</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">bn_function</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">inputs</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># type: (List[Tensor]) -&gt; Tensor</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">concated_features</span> = <span class="cm-variable">torch</span>.<span class="cm-property">cat</span>(<span class="cm-variable">inputs</span>, <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">bottleneck_output</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">relu1</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">norm1</span>(<span class="cm-variable">concated_features</span>))) &nbsp;<span class="cm-comment"># noqa: T484</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">bottleneck_output</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># todo: rewrite when torchscript supports any</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">any_requires_grad</span>(<span class="cm-variable-2">self</span>, <span class="cm-builtin">input</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># type: (List[Tensor]) -&gt; bool</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">tensor</span> <span class="cm-keyword">in</span> <span class="cm-builtin">input</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">tensor</span>.<span class="cm-property">requires_grad</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">True</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">False</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@torch</span>.<span class="cm-property">jit</span>.<span class="cm-property">unused</span> &nbsp;<span class="cm-comment"># noqa: T484</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">call_checkpoint_bottleneck</span>(<span class="cm-variable-2">self</span>, <span class="cm-builtin">input</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># type: (List[Tensor]) -&gt; Tensor</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">closure</span>(<span class="cm-operator">*</span><span class="cm-variable">inputs</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable-2">self</span>.<span class="cm-property">bn_function</span>(<span class="cm-operator">*</span><span class="cm-variable">inputs</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">cp</span>.<span class="cm-property">checkpoint</span>(<span class="cm-variable">closure</span>, <span class="cm-builtin">input</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@torch</span>.<span class="cm-property">jit</span>.<span class="cm-property">_overload_method</span> &nbsp;<span class="cm-comment"># noqa: F811</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># torchscript does not yet support *args, so we overload method</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># allowing it to take either a List[Tensor] or single Tensor</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">forward</span>(<span class="cm-variable-2">self</span>, <span class="cm-builtin">input</span>): &nbsp;<span class="cm-comment"># noqa: F811</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-builtin">isinstance</span>(<span class="cm-builtin">input</span>, <span class="cm-variable">Tensor</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">prev_features</span> = [<span class="cm-builtin">input</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">prev_features</span> = <span class="cm-builtin">input</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable-2">self</span>.<span class="cm-property">memory_efficient</span> <span class="cm-keyword">and</span> <span class="cm-variable-2">self</span>.<span class="cm-property">any_requires_grad</span>(<span class="cm-variable">prev_features</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">torch</span>.<span class="cm-property">jit</span>.<span class="cm-property">is_scripting</span>():</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">raise</span> <span class="cm-variable">Exception</span>(<span class="cm-string">"Memory Efficient not supported in JIT"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">bottleneck_output</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">call_checkpoint_bottleneck</span>(<span class="cm-variable">prev_features</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">bottleneck_output</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">bn_function</span>(<span class="cm-variable">prev_features</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">new_features</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">conv2</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">relu2</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">norm2</span>(<span class="cm-variable">bottleneck_output</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable-2">self</span>.<span class="cm-property">drop_rate</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">new_features</span> = <span class="cm-variable">F</span>.<span class="cm-property">dropout</span>(<span class="cm-variable">new_features</span>, <span class="cm-variable">p</span>=<span class="cm-variable-2">self</span>.<span class="cm-property">drop_rate</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">training</span>=<span class="cm-variable-2">self</span>.<span class="cm-property">training</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">new_features</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1411px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1411px;"></div></div></div></pre><h3><a name="googlenet" class="md-header-anchor"></a><span>GoogleNet</span></h3><p><strong><span>模型下载链接:</span></strong></p><p><strong><span>模型介绍:</span></strong></p><p><span>GoogLeNet是2014年Christian Szegedy提出的一种全新的深度学习结构，在这之前的AlexNet、VGG等结构都是通过增大网络的深度（层数）来获得更好的训练效果，但层数的增加会带来很多负作用，比如overfit、梯度消失、梯度爆炸等。inception的提出则从另一种角度来提升训练结果：能更高效的利用计算资源，在相同的计算量下能提取到更多的特征，从而提升训练结果。</span></p><p><span>GoogleNet核心点共包括2个要素:</span></p><p><span>1)1x1卷积  2)多个尺寸上进行卷积再聚合</span></p><p><span>核心网络层大致结构:</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144642801-228879574.png" referrerpolicy="no-referrer"></p><p><span>模型大致结构:</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144654735-578524947.png" referrerpolicy="no-referrer"></p><p><strong><span>pytorch实现代码:</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">GoogLeNet</span>(<span class="cm-variable">nn</span>.<span class="cm-property">Module</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">__constants__</span> = [<span class="cm-string">'aux_logits'</span>, <span class="cm-string">'transform_input'</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">num_classes</span>=<span class="cm-number">1000</span>, <span class="cm-variable">aux_logits</span>=<span class="cm-keyword">True</span>, <span class="cm-variable">transform_input</span>=<span class="cm-keyword">False</span>, <span class="cm-variable">init_weights</span>=<span class="cm-keyword">None</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">blocks</span>=<span class="cm-keyword">None</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">super</span>(<span class="cm-variable">GoogLeNet</span>, <span class="cm-variable-2">self</span>).<span class="cm-property">__init__</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">blocks</span> <span class="cm-keyword">is</span> <span class="cm-keyword">None</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">blocks</span> = [<span class="cm-variable">BasicConv2d</span>, <span class="cm-variable">Inception</span>, <span class="cm-variable">InceptionAux</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">init_weights</span> <span class="cm-keyword">is</span> <span class="cm-keyword">None</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">warnings</span>.<span class="cm-property">warn</span>(<span class="cm-string">'The default weight initialization of GoogleNet will be changed in future releases of '</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'torchvision. If you wish to keep the old behavior (which leads to long initialization times'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">' due to scipy/scipy#11299), please set init_weights=True.'</span>, <span class="cm-variable">FutureWarning</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">init_weights</span> = <span class="cm-keyword">True</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">assert</span> <span class="cm-builtin">len</span>(<span class="cm-variable">blocks</span>) == <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">conv_block</span> = <span class="cm-variable">blocks</span>[<span class="cm-number">0</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">inception_block</span> = <span class="cm-variable">blocks</span>[<span class="cm-number">1</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">inception_aux_block</span> = <span class="cm-variable">blocks</span>[<span class="cm-number">2</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">aux_logits</span> = <span class="cm-variable">aux_logits</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">transform_input</span> = <span class="cm-variable">transform_input</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span> = <span class="cm-variable">conv_block</span>(<span class="cm-number">3</span>, <span class="cm-number">64</span>, <span class="cm-variable">kernel_size</span>=<span class="cm-number">7</span>, <span class="cm-variable">stride</span>=<span class="cm-number">2</span>, <span class="cm-variable">padding</span>=<span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">maxpool1</span> = <span class="cm-variable">nn</span>.<span class="cm-property">MaxPool2d</span>(<span class="cm-number">3</span>, <span class="cm-variable">stride</span>=<span class="cm-number">2</span>, <span class="cm-variable">ceil_mode</span>=<span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv2</span> = <span class="cm-variable">conv_block</span>(<span class="cm-number">64</span>, <span class="cm-number">64</span>, <span class="cm-variable">kernel_size</span>=<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv3</span> = <span class="cm-variable">conv_block</span>(<span class="cm-number">64</span>, <span class="cm-number">192</span>, <span class="cm-variable">kernel_size</span>=<span class="cm-number">3</span>, <span class="cm-variable">padding</span>=<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">maxpool2</span> = <span class="cm-variable">nn</span>.<span class="cm-property">MaxPool2d</span>(<span class="cm-number">3</span>, <span class="cm-variable">stride</span>=<span class="cm-number">2</span>, <span class="cm-variable">ceil_mode</span>=<span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">inception3a</span> = <span class="cm-variable">inception_block</span>(<span class="cm-number">192</span>, <span class="cm-number">64</span>, <span class="cm-number">96</span>, <span class="cm-number">128</span>, <span class="cm-number">16</span>, <span class="cm-number">32</span>, <span class="cm-number">32</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">inception3b</span> = <span class="cm-variable">inception_block</span>(<span class="cm-number">256</span>, <span class="cm-number">128</span>, <span class="cm-number">128</span>, <span class="cm-number">192</span>, <span class="cm-number">32</span>, <span class="cm-number">96</span>, <span class="cm-number">64</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">maxpool3</span> = <span class="cm-variable">nn</span>.<span class="cm-property">MaxPool2d</span>(<span class="cm-number">3</span>, <span class="cm-variable">stride</span>=<span class="cm-number">2</span>, <span class="cm-variable">ceil_mode</span>=<span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">inception4a</span> = <span class="cm-variable">inception_block</span>(<span class="cm-number">480</span>, <span class="cm-number">192</span>, <span class="cm-number">96</span>, <span class="cm-number">208</span>, <span class="cm-number">16</span>, <span class="cm-number">48</span>, <span class="cm-number">64</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">inception4b</span> = <span class="cm-variable">inception_block</span>(<span class="cm-number">512</span>, <span class="cm-number">160</span>, <span class="cm-number">112</span>, <span class="cm-number">224</span>, <span class="cm-number">24</span>, <span class="cm-number">64</span>, <span class="cm-number">64</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">inception4c</span> = <span class="cm-variable">inception_block</span>(<span class="cm-number">512</span>, <span class="cm-number">128</span>, <span class="cm-number">128</span>, <span class="cm-number">256</span>, <span class="cm-number">24</span>, <span class="cm-number">64</span>, <span class="cm-number">64</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">inception4d</span> = <span class="cm-variable">inception_block</span>(<span class="cm-number">512</span>, <span class="cm-number">112</span>, <span class="cm-number">144</span>, <span class="cm-number">288</span>, <span class="cm-number">32</span>, <span class="cm-number">64</span>, <span class="cm-number">64</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">inception4e</span> = <span class="cm-variable">inception_block</span>(<span class="cm-number">528</span>, <span class="cm-number">256</span>, <span class="cm-number">160</span>, <span class="cm-number">320</span>, <span class="cm-number">32</span>, <span class="cm-number">128</span>, <span class="cm-number">128</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">maxpool4</span> = <span class="cm-variable">nn</span>.<span class="cm-property">MaxPool2d</span>(<span class="cm-number">2</span>, <span class="cm-variable">stride</span>=<span class="cm-number">2</span>, <span class="cm-variable">ceil_mode</span>=<span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">inception5a</span> = <span class="cm-variable">inception_block</span>(<span class="cm-number">832</span>, <span class="cm-number">256</span>, <span class="cm-number">160</span>, <span class="cm-number">320</span>, <span class="cm-number">32</span>, <span class="cm-number">128</span>, <span class="cm-number">128</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">inception5b</span> = <span class="cm-variable">inception_block</span>(<span class="cm-number">832</span>, <span class="cm-number">384</span>, <span class="cm-number">192</span>, <span class="cm-number">384</span>, <span class="cm-number">48</span>, <span class="cm-number">128</span>, <span class="cm-number">128</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">aux_logits</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">aux1</span> = <span class="cm-variable">inception_aux_block</span>(<span class="cm-number">512</span>, <span class="cm-variable">num_classes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">aux2</span> = <span class="cm-variable">inception_aux_block</span>(<span class="cm-number">528</span>, <span class="cm-variable">num_classes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">aux1</span> = <span class="cm-keyword">None</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">aux2</span> = <span class="cm-keyword">None</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">avgpool</span> = <span class="cm-variable">nn</span>.<span class="cm-property">AdaptiveAvgPool2d</span>((<span class="cm-number">1</span>, <span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">dropout</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Dropout</span>(<span class="cm-number">0.2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">fc</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">1024</span>, <span class="cm-variable">num_classes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">init_weights</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">_initialize_weights</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">_initialize_weights</span>(<span class="cm-variable-2">self</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">m</span> <span class="cm-keyword">in</span> <span class="cm-variable-2">self</span>.<span class="cm-property">modules</span>():</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-builtin">isinstance</span>(<span class="cm-variable">m</span>, <span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>) <span class="cm-keyword">or</span> <span class="cm-builtin">isinstance</span>(<span class="cm-variable">m</span>, <span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">import</span> <span class="cm-variable">scipy</span>.<span class="cm-property">stats</span> <span class="cm-keyword">as</span> <span class="cm-variable">stats</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">X</span> = <span class="cm-variable">stats</span>.<span class="cm-property">truncnorm</span>(<span class="cm-operator">-</span><span class="cm-number">2</span>, <span class="cm-number">2</span>, <span class="cm-variable">scale</span>=<span class="cm-number">0.01</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">values</span> = <span class="cm-variable">torch</span>.<span class="cm-property">as_tensor</span>(<span class="cm-variable">X</span>.<span class="cm-property">rvs</span>(<span class="cm-variable">m</span>.<span class="cm-property">weight</span>.<span class="cm-property">numel</span>()), <span class="cm-variable">dtype</span>=<span class="cm-variable">m</span>.<span class="cm-property">weight</span>.<span class="cm-property">dtype</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">values</span> = <span class="cm-variable">values</span>.<span class="cm-property">view</span>(<span class="cm-variable">m</span>.<span class="cm-property">weight</span>.<span class="cm-property">size</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">with</span> <span class="cm-variable">torch</span>.<span class="cm-property">no_grad</span>():</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">m</span>.<span class="cm-property">weight</span>.<span class="cm-property">copy_</span>(<span class="cm-variable">values</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">elif</span> <span class="cm-builtin">isinstance</span>(<span class="cm-variable">m</span>, <span class="cm-variable">nn</span>.<span class="cm-property">BatchNorm2d</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">init</span>.<span class="cm-property">constant_</span>(<span class="cm-variable">m</span>.<span class="cm-property">weight</span>, <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">init</span>.<span class="cm-property">constant_</span>(<span class="cm-variable">m</span>.<span class="cm-property">bias</span>, <span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">_transform_input</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># type: (Tensor) -&gt; Tensor</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable-2">self</span>.<span class="cm-property">transform_input</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_ch0</span> = <span class="cm-variable">torch</span>.<span class="cm-property">unsqueeze</span>(<span class="cm-variable">x</span>[:, <span class="cm-number">0</span>], <span class="cm-number">1</span>) <span class="cm-operator">*</span> (<span class="cm-number">0.229</span> <span class="cm-operator">/</span> <span class="cm-number">0.5</span>) <span class="cm-operator">+</span> (<span class="cm-number">0.485</span> <span class="cm-operator">-</span> <span class="cm-number">0.5</span>) <span class="cm-operator">/</span> <span class="cm-number">0.5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_ch1</span> = <span class="cm-variable">torch</span>.<span class="cm-property">unsqueeze</span>(<span class="cm-variable">x</span>[:, <span class="cm-number">1</span>], <span class="cm-number">1</span>) <span class="cm-operator">*</span> (<span class="cm-number">0.224</span> <span class="cm-operator">/</span> <span class="cm-number">0.5</span>) <span class="cm-operator">+</span> (<span class="cm-number">0.456</span> <span class="cm-operator">-</span> <span class="cm-number">0.5</span>) <span class="cm-operator">/</span> <span class="cm-number">0.5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_ch2</span> = <span class="cm-variable">torch</span>.<span class="cm-property">unsqueeze</span>(<span class="cm-variable">x</span>[:, <span class="cm-number">2</span>], <span class="cm-number">1</span>) <span class="cm-operator">*</span> (<span class="cm-number">0.225</span> <span class="cm-operator">/</span> <span class="cm-number">0.5</span>) <span class="cm-operator">+</span> (<span class="cm-number">0.406</span> <span class="cm-operator">-</span> <span class="cm-number">0.5</span>) <span class="cm-operator">/</span> <span class="cm-number">0.5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable">torch</span>.<span class="cm-property">cat</span>((<span class="cm-variable">x_ch0</span>, <span class="cm-variable">x_ch1</span>, <span class="cm-variable">x_ch2</span>), <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">x</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">_forward</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># type: (Tensor) -&gt; Tuple[Tensor, Optional[Tensor], Optional[Tensor]]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 3 x 224 x 224</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 64 x 112 x 112</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">maxpool1</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 64 x 56 x 56</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">conv2</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 64 x 56 x 56</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">conv3</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 192 x 56 x 56</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">maxpool2</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 192 x 28 x 28</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">inception3a</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 256 x 28 x 28</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">inception3b</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 480 x 28 x 28</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">maxpool3</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 480 x 14 x 14</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">inception4a</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 512 x 14 x 14</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">aux1</span> = <span class="cm-variable">torch</span>.<span class="cm-property">jit</span>.<span class="cm-property">annotate</span>(<span class="cm-variable">Optional</span>[<span class="cm-variable">Tensor</span>], <span class="cm-keyword">None</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable-2">self</span>.<span class="cm-property">aux1</span> <span class="cm-keyword">is</span> <span class="cm-keyword">not</span> <span class="cm-keyword">None</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable-2">self</span>.<span class="cm-property">training</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">aux1</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">aux1</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">inception4b</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 512 x 14 x 14</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">inception4c</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 512 x 14 x 14</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">inception4d</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 528 x 14 x 14</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">aux2</span> = <span class="cm-variable">torch</span>.<span class="cm-property">jit</span>.<span class="cm-property">annotate</span>(<span class="cm-variable">Optional</span>[<span class="cm-variable">Tensor</span>], <span class="cm-keyword">None</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable-2">self</span>.<span class="cm-property">aux2</span> <span class="cm-keyword">is</span> <span class="cm-keyword">not</span> <span class="cm-keyword">None</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable-2">self</span>.<span class="cm-property">training</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">aux2</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">aux2</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">inception4e</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 832 x 14 x 14</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">maxpool4</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 832 x 7 x 7</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">inception5a</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 832 x 7 x 7</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">inception5b</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 1024 x 7 x 7</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">avgpool</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 1024 x 1 x 1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable">torch</span>.<span class="cm-property">flatten</span>(<span class="cm-variable">x</span>, <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 1024</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">dropout</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">fc</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># N x 1000 (num_classes)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">x</span>, <span class="cm-variable">aux2</span>, <span class="cm-variable">aux1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@torch</span>.<span class="cm-property">jit</span>.<span class="cm-property">unused</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">eager_outputs</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>, <span class="cm-variable">aux2</span>, <span class="cm-variable">aux1</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># type: (Tensor, Optional[Tensor], Optional[Tensor]) -&gt; GoogLeNetOutputs</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable-2">self</span>.<span class="cm-property">training</span> <span class="cm-keyword">and</span> <span class="cm-variable-2">self</span>.<span class="cm-property">aux_logits</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">_GoogLeNetOutputs</span>(<span class="cm-variable">x</span>, <span class="cm-variable">aux2</span>, <span class="cm-variable">aux1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">x</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">forward</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># type: (Tensor) -&gt; GoogLeNetOutputs</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">_transform_input</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span>, <span class="cm-variable">aux1</span>, <span class="cm-variable">aux2</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">_forward</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">aux_defined</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">training</span> <span class="cm-keyword">and</span> <span class="cm-variable-2">self</span>.<span class="cm-property">aux_logits</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">torch</span>.<span class="cm-property">jit</span>.<span class="cm-property">is_scripting</span>():</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-keyword">not</span> <span class="cm-variable">aux_defined</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">warnings</span>.<span class="cm-property">warn</span>(<span class="cm-string">"Scripted GoogleNet always returns GoogleNetOutputs Tuple"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GoogLeNetOutputs</span>(<span class="cm-variable">x</span>, <span class="cm-variable">aux2</span>, <span class="cm-variable">aux1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable-2">self</span>.<span class="cm-property">eager_outputs</span>(<span class="cm-variable">x</span>, <span class="cm-variable">aux2</span>, <span class="cm-variable">aux1</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 3494px;"></div><div class="CodeMirror-gutters" style="display: none; height: 3494px;"></div></div></div></pre><h3><a name="vggnet" class="md-header-anchor"></a><span>VggNet</span></h3><p><strong><span>模型下载链接:</span></strong></p><p><strong><span>模型介绍:</span></strong></p><p><span>   VGGNet由牛津大学计算机视觉组合和Google DeepMind公司研究员一起研发的深度卷积神经网络。它探索了卷积神经网络的深度和其性能之间的关系，通过反复的堆叠3x3的小型卷积核和2x2的最大池化层，成功的构建了16~19层深的卷积神经网络。VGGNet获得了ILSVRC 2014年比赛的亚军和定位项目的冠军，在top5上的错误率为7.5%。目前为止，VGGNet依然被用来提取图像的特征。</span>
<span>GGNet全部使用3x3的卷积核和2x2的池化核，通过不断加深网络结构来提升性能。网络层数的增长并不会带来参数量上的爆炸，因为参数量主要集中在最后三个全连接层中。同时，两个3x3卷积层的串联相当于1个5x5的卷积层，3个3x3的卷积层串联相当于1个7x7的卷积层，即3个3x3卷积层的感受野大小相当于1个7x7的卷积层。但是3个3x3的卷积层参数量只有7x7的一半左右，同时前者可以有3个非线性操作，而后者只有1个非线性操作，这样使得前者对于特征的学习能力更强。</span></p><p><span>模型大致结构:</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144715428-40220860.png" referrerpolicy="no-referrer"></p><p><strong><span>pytorch生成代码:</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">VGG</span>(<span class="cm-variable">nn</span>.<span class="cm-property">Module</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">features</span>, <span class="cm-variable">num_classes</span>=<span class="cm-number">1000</span>, <span class="cm-variable">init_weights</span>=<span class="cm-keyword">True</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">super</span>(<span class="cm-variable">VGG</span>, <span class="cm-variable-2">self</span>).<span class="cm-property">__init__</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">features</span> = <span class="cm-variable">features</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">avgpool</span> = <span class="cm-variable">nn</span>.<span class="cm-property">AdaptiveAvgPool2d</span>((<span class="cm-number">7</span>, <span class="cm-number">7</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">classifier</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Sequential</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">512</span> <span class="cm-operator">*</span> <span class="cm-number">7</span> <span class="cm-operator">*</span> <span class="cm-number">7</span>, <span class="cm-number">4096</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-keyword">True</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Dropout</span>(),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">4096</span>, <span class="cm-number">4096</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-keyword">True</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Dropout</span>(),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">4096</span>, <span class="cm-variable">num_classes</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">init_weights</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">_initialize_weights</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">forward</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">features</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">avgpool</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable">torch</span>.<span class="cm-property">flatten</span>(<span class="cm-variable">x</span>, <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">classifier</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">x</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 538px;"></div><div class="CodeMirror-gutters" style="display: none; height: 538px;"></div></div></div></pre><h3><a name="shufflenet" class="md-header-anchor"></a><span>ShuffleNet</span></h3><p><strong><span>模型下载链接:</span></strong></p><p><strong><span>模型介绍</span></strong></p><p><span>ShuffleNet是专门为计算能力非常有限的移动设备（例如，10-150 MFLOPs）而设计的。该结构利用分组逐点卷积（pointwise group convolution）和通道重排（channel shuffle）两种新的运算方法，在保证计算精度的同时，大大降低了计算成本。ImageNet分类和MS COCO目标检测实验表明，在40 MFLOPs计算预算下，ShuffleNet的性能优于其他结构，例如，在ImageNet分类任务上，与最近的MobileNet相比，top-1错误率（绝对7.8%）更低。在基于arm的移动设备上，ShuffleNet比AlexNet实现了约13倍的实际加速，同时保持了相当的准确性。</span></p><p><span>ShuffleNet单元结构：</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144732292-658549809.png" referrerpolicy="no-referrer"></p><p><span>模型大致结构:</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144744425-1378553274.png" referrerpolicy="no-referrer"></p><p><strong><span>pytorch生成代码:</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ShuffleNetV2</span>(<span class="cm-variable">nn</span>.<span class="cm-property">Module</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">stages_repeats</span>, <span class="cm-variable">stages_out_channels</span>, <span class="cm-variable">num_classes</span>=<span class="cm-number">1000</span>, <span class="cm-variable">inverted_residual</span>=<span class="cm-variable">InvertedResidual</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">super</span>(<span class="cm-variable">ShuffleNetV2</span>, <span class="cm-variable-2">self</span>).<span class="cm-property">__init__</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-builtin">len</span>(<span class="cm-variable">stages_repeats</span>) <span class="cm-operator">!</span>= <span class="cm-number">3</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">raise</span> <span class="cm-variable">ValueError</span>(<span class="cm-string">'expected stages_repeats as list of 3 positive ints'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-builtin">len</span>(<span class="cm-variable">stages_out_channels</span>) <span class="cm-operator">!</span>= <span class="cm-number">5</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">raise</span> <span class="cm-variable">ValueError</span>(<span class="cm-string">'expected stages_out_channels as list of 5 positive ints'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">_stage_out_channels</span> = <span class="cm-variable">stages_out_channels</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">input_channels</span> = <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">output_channels</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">_stage_out_channels</span>[<span class="cm-number">0</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Sequential</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-variable">input_channels</span>, <span class="cm-variable">output_channels</span>, <span class="cm-number">3</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>, <span class="cm-variable">bias</span>=<span class="cm-keyword">False</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">BatchNorm2d</span>(<span class="cm-variable">output_channels</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-variable">inplace</span>=<span class="cm-keyword">True</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">input_channels</span> = <span class="cm-variable">output_channels</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">maxpool</span> = <span class="cm-variable">nn</span>.<span class="cm-property">MaxPool2d</span>(<span class="cm-variable">kernel_size</span>=<span class="cm-number">3</span>, <span class="cm-variable">stride</span>=<span class="cm-number">2</span>, <span class="cm-variable">padding</span>=<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stage_names</span> = [<span class="cm-string">'stage{}'</span>.<span class="cm-property">format</span>(<span class="cm-variable">i</span>) <span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> [<span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-number">4</span>]]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">name</span>, <span class="cm-variable">repeats</span>, <span class="cm-variable">output_channels</span> <span class="cm-keyword">in</span> <span class="cm-builtin">zip</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stage_names</span>, <span class="cm-variable">stages_repeats</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">_stage_out_channels</span>[<span class="cm-number">1</span>:]):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq</span> = [<span class="cm-variable">inverted_residual</span>(<span class="cm-variable">input_channels</span>, <span class="cm-variable">output_channels</span>, <span class="cm-number">2</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-variable">repeats</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq</span>.<span class="cm-property">append</span>(<span class="cm-variable">inverted_residual</span>(<span class="cm-variable">output_channels</span>, <span class="cm-variable">output_channels</span>, <span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">setattr</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">name</span>, <span class="cm-variable">nn</span>.<span class="cm-property">Sequential</span>(<span class="cm-operator">*</span><span class="cm-variable">seq</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">input_channels</span> = <span class="cm-variable">output_channels</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">output_channels</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">_stage_out_channels</span>[<span class="cm-operator">-</span><span class="cm-number">1</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv5</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Sequential</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-variable">input_channels</span>, <span class="cm-variable">output_channels</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>, <span class="cm-number">0</span>, <span class="cm-variable">bias</span>=<span class="cm-keyword">False</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">BatchNorm2d</span>(<span class="cm-variable">output_channels</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(<span class="cm-variable">inplace</span>=<span class="cm-keyword">True</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">fc</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-variable">output_channels</span>, <span class="cm-variable">num_classes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">_forward_impl</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># See note [TorchScript super()]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">maxpool</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">stage2</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">stage3</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">stage4</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">conv5</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable">x</span>.<span class="cm-property">mean</span>([<span class="cm-number">2</span>, <span class="cm-number">3</span>]) &nbsp;<span class="cm-comment"># globalpool</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">fc</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">x</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">forward</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable-2">self</span>.<span class="cm-property">_forward_impl</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1232px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1232px;"></div></div></div></pre><p>&nbsp;</p><h2><a name="教学模型" class="md-header-anchor"></a><span>教学模型</span></h2><h3><a name="mnist预测模型" class="md-header-anchor"></a><strong><span>mnist预测模型</span></strong><span> </span></h3><h3><a name="mnist数据集介绍" class="md-header-anchor"></a><span>mnist数据集介绍</span></h3><p><span>MNIST 数据集来自美国国家标准与技术研究所, National Institute of Standards and Technology (NIST). 训练集 (training set) 由来自 250 个不同人手写的数字构成, 其中 50% 是高中学生, 50% 来自人口普查局 (the Census Bureau) 的工作人员. 测试集(test set) 也是同样比例的手写数字数据。</span></p><h3><a name="mnistmodel1" class="md-header-anchor"></a><strong><span>mnist_model1</span></strong></h3><p><strong><span>模型链接:</span></strong></p><p><span>以下介绍对于mnist数据集的一个简单的预测模型,只使用了激活层和全连接层，具体结构如下图所示:</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144836824-272026463.png" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><span>如上图所示，本模型结构较为简单，将全连接层串联在一起，并在每个全连接层之间使用Relu进行激活。</span></p><p><span>生成的具体函数如下图所示:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Net</span>(<span class="cm-variable">torch</span>.<span class="cm-property">nn</span>.<span class="cm-property">Module</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">super</span>(<span class="cm-variable">Net</span>, <span class="cm-variable-2">self</span>).<span class="cm-property">__init__</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">self</span>.<span class="cm-property">l1</span> = <span class="cm-variable">torch</span>.<span class="cm-property">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">784</span>, <span class="cm-number">512</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">self</span>.<span class="cm-property">l2</span> = <span class="cm-variable">torch</span>.<span class="cm-property">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">512</span>, <span class="cm-number">256</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">self</span>.<span class="cm-property">l3</span> = <span class="cm-variable">torch</span>.<span class="cm-property">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">256</span>, <span class="cm-number">128</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">self</span>.<span class="cm-property">l4</span> = <span class="cm-variable">torch</span>.<span class="cm-property">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">128</span>, <span class="cm-number">64</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">self</span>.<span class="cm-property">l5</span> = <span class="cm-variable">torch</span>.<span class="cm-property">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">64</span>, <span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">forward</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span> = <span class="cm-variable">x</span>.<span class="cm-property">view</span>(<span class="cm-operator">-</span><span class="cm-number">1</span>, <span class="cm-number">784</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span> = <span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">l1</span>(<span class="cm-variable">x</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span> = <span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">l2</span>(<span class="cm-variable">x</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span> = <span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">l3</span>(<span class="cm-variable">x</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span> = <span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">l4</span>(<span class="cm-variable">x</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">return</span> <span class="cm-variable-2">self</span>.<span class="cm-property">l5</span>(<span class="cm-variable">x</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p><span> 本模型对应的损失函数为CrossEntropyLoss(交叉商损失函数),具体计算步骤可参见下图内容:</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144857690-1220395733.png" referrerpolicy="no-referrer"></p><p><span>如上图所示，CrossEntropyLoss将softmax层与NLLLOSS函数进行拼接，最后输出的向量中保证只有一个分量的值为1，其他分量的值为0。mnist数据集模型要求对于数字0-9图片进行分类并且识别，因此CrossEntropyLoss具有非常好的适用性。</span></p><p><span>虽然结构较为简单，但是mnist_model1具有非常高的准确性，能够达到97%的准确率。具体结果如下图所示：</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144909076-1696762777.png" referrerpolicy="no-referrer"></p><h3><a name="mnistmodel2" class="md-header-anchor"></a><strong><span>mnist_model2</span></strong></h3><p><strong><span>模型链接：</span></strong></p><p><span>mnist_model2在mnist_model1的基础上增加了卷积层以及池化层，能够哦更好地对图片进行分类识别，模型具体结构如下图所示:</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517144930613-914135232.png" referrerpolicy="no-referrer"></p><p><span>mnist_model2对输入数据进行了两次卷积以及池化，同时在池化后对数据内容进行激活。最终经过全连接层后进行结果输出。</span></p><p><span>生成的具体函数代码如下图所示:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Net</span>(<span class="cm-variable">torch</span>.<span class="cm-property">nn</span>.<span class="cm-property">Module</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">super</span>(<span class="cm-variable">Net</span>, <span class="cm-variable-2">self</span>).<span class="cm-property">__init__</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span> = <span class="cm-variable">torch</span>.<span class="cm-property">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">1</span>, <span class="cm-number">10</span>, <span class="cm-variable">kernel_size</span>=<span class="cm-number">5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">self</span>.<span class="cm-property">conv2</span> = <span class="cm-variable">torch</span>.<span class="cm-property">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">10</span>, <span class="cm-number">20</span>, <span class="cm-variable">kernel_size</span>=<span class="cm-number">5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">self</span>.<span class="cm-property">pooling</span> = <span class="cm-variable">torch</span>.<span class="cm-property">nn</span>.<span class="cm-property">MaxPool2d</span>(<span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">self</span>.<span class="cm-property">fc</span> = <span class="cm-variable">torch</span>.<span class="cm-property">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">320</span>, <span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">forward</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">batch_size</span> = <span class="cm-variable">x</span>.<span class="cm-property">size</span>(<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span> = <span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">pooling</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span>(<span class="cm-variable">x</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span> = <span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">pooling</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">conv2</span>(<span class="cm-variable">x</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span> = <span class="cm-variable">x</span>.<span class="cm-property">view</span>(<span class="cm-variable">batch_size</span>, <span class="cm-operator">-</span><span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">fc</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">return</span> <span class="cm-variable">x</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p><span>本模型使用的损失函数与mnist_model1相同，不再赘述。</span></p><p><span>mnist_model2由于采用了更适合进行图像识别的卷积层，因此对于图像识别的准确率更高，具体数值如下图所示:</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517145014123-2119682207.png" referrerpolicy="no-referrer"></p><p><span>由上图可见，mnist_model2的准确率达到了98%。虽然相较于mnist_model1只高出了1%，但从比例上来查看相较于mnist_model1的出错率降低了1/3，在进行较大规模图像识别时本模型具有较高的优势。</span></p><h2><a name="cifar10预测模型" class="md-header-anchor"></a><span>cifar10预测模型</span></h2><h3><a name="cifar10数据集介绍" class="md-header-anchor"></a><span>cifar10数据集介绍</span></h3><p><span>CIFAR-10 是由 Hinton 的学生 Alex Krizhevsky 和 Ilya Sutskever 整理的一个用于识别普适物体的小型数据集。一共包含 10 个类别的 RGB 彩色图 片：飞机（ a叩lane ）、汽车（ automobile ）、鸟类（ bird ）、猫（ cat ）、鹿（ deer ）、狗（ dog ）、蛙类（ frog ）、马（ horse ）、船（ ship ）和卡车（ truck ）。图片的尺寸为 32×32 ，数据集中一共有 50000 张训练圄片和 10000 张测试图片。 CIFAR-10 的图片样例如图所示。</span>
<span>下面这幅图就是列举了10各类，每一类展示了随机的10张图片：</span></p><p>&nbsp;</p><p><span>与 MNIST 数据集中目比， CIFAR-10 具有以下不同点：</span>
<span>• CIFAR-10 是 3 通道的彩色 RGB 图像，而 MNIST 是灰度图像。</span>
<span>• CIFAR-10 的图片尺寸为 32×32， 而 MNIST 的图片尺寸为 28×28，比 MNIST 稍大。</span>
<span>• 相比于手写字符， CIFAR-10 含有的是现实世界中真实的物体，不仅噪声很大，而且物体的比例、 特征都不尽相同，这为识别带来很大困难。 直接的线性模型如 Softmax 在 CIFAR-10 上表现得很差。</span></p><h3><a name="cifar10model1" class="md-header-anchor"></a><span>cifar10_model1</span></h3><p><strong><span>模型链接</span></strong><span>:</span></p><p><span>该模型参照了pytorch官网对于cifar10数据集的</span><a href='https://pytorch.org/tutorials/beginner/blitz/cifar10_tutorial.html'><span>教程</span></a><span>。本模型结构较为简单，只对数据进行了卷积、池化以及全连接操作。模型结构如下图所示:</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517145028377-388139661.png" referrerpolicy="no-referrer"></p><p><span>这种结构的网络效果其实不好，因为全连接层传递效率较低，同时会干扰到卷积层提取出的局部特征，并且也没有用到BatchNorm和Dropout来防止过拟合的问题。而cifar10数据集结构较为复杂，因此cifar10_model1精度较差。</span></p><p><span>生成具体函数代码如下图所示:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Net</span>(<span class="cm-variable">nn</span>.<span class="cm-property">Module</span>): &nbsp; &nbsp;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-builtin cm-error">super</span>(<span class="cm-variable">Net</span>, <span class="cm-variable-2">self</span>).<span class="cm-property">__init__</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">3</span>, <span class="cm-number">6</span>, <span class="cm-number">5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">pool</span> = <span class="cm-variable">nn</span>.<span class="cm-property">MaxPool2d</span>(<span class="cm-number">2</span>, <span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv2</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">6</span>, <span class="cm-number">16</span>, <span class="cm-number">5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">fc1</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">16</span> <span class="cm-operator">*</span> <span class="cm-number">5</span> <span class="cm-operator">*</span> <span class="cm-number">5</span>, <span class="cm-number">120</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">fc2</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">120</span>, <span class="cm-number">84</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">fc3</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">84</span>, <span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">forward</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">pool</span>(<span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span>(<span class="cm-variable">x</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">pool</span>(<span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">conv2</span>(<span class="cm-variable">x</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable">x</span>.<span class="cm-property">view</span>(<span class="cm-operator">-</span><span class="cm-number">1</span>, <span class="cm-number">16</span> <span class="cm-operator">*</span> <span class="cm-number">5</span> <span class="cm-operator">*</span> <span class="cm-number">5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">fc1</span>(<span class="cm-variable">x</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">fc2</span>(<span class="cm-variable">x</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">fc3</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 403px;"></div><div class="CodeMirror-gutters" style="display: none; height: 403px;"></div></div></div></pre><p><span>由于数据集与mnist同为图像分类识别数据集，因此损失函数和优化器与mnist数据集中的保持一致，如下图所示:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">criterion</span> = <span class="cm-variable">nn</span>.<span class="cm-property">CrossEntropyLoss</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">optimizer</span> = <span class="cm-variable">optim</span>.<span class="cm-property">Adam</span>(<span class="cm-variable">net</span>.<span class="cm-property">parameters</span>(), <span class="cm-variable">lr</span>=<span class="cm-number">0.001</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>模型最终的准确率并不高，能够达到 %,如下图所示:</span></p><p>&nbsp;</p><h3><a name="cifar10model2" class="md-header-anchor"></a><span>cifar10_model2</span></h3><p><strong><span>模型链接:</span></strong></p><p><span>在cifar10_model1的基础上，cifar10_model2增加了batchnorm层以及dropout层防止过拟合操作。具体模型结构如下图所示:</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517145103974-481627789.png" referrerpolicy="no-referrer"></p><p><span>对于cifar10这样结构较为复杂的数据集，cifar10_model2能够去除数据中的噪声同时有效防止过拟合。</span></p><p><span>生成的代码如下所示:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Net</span>(<span class="cm-variable">nn</span>.<span class="cm-property">Module</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">super</span>(<span class="cm-variable">Net</span>, <span class="cm-variable-2">self</span>).<span class="cm-property">__init__</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">3</span>, <span class="cm-number">64</span>, <span class="cm-number">3</span>, <span class="cm-variable">padding</span> = <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv2</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">64</span>, <span class="cm-number">64</span>, <span class="cm-number">3</span>, <span class="cm-variable">padding</span> = <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv3</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">64</span>, <span class="cm-number">128</span>, <span class="cm-number">3</span>, <span class="cm-variable">padding</span> = <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv4</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">128</span>, <span class="cm-number">128</span>, <span class="cm-number">3</span>, <span class="cm-variable">padding</span> = <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv5</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">128</span>, <span class="cm-number">256</span>, <span class="cm-number">3</span>, <span class="cm-variable">padding</span> = <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">conv6</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Conv2d</span>(<span class="cm-number">256</span>, <span class="cm-number">256</span>, <span class="cm-number">3</span>, <span class="cm-variable">padding</span> = <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">maxpool</span> = <span class="cm-variable">nn</span>.<span class="cm-property">MaxPool2d</span>(<span class="cm-number">2</span>, <span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">avgpool</span> = <span class="cm-variable">nn</span>.<span class="cm-property">AvgPool2d</span>(<span class="cm-number">2</span>, <span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">globalavgpool</span> = <span class="cm-variable">nn</span>.<span class="cm-property">AvgPool2d</span>(<span class="cm-number">8</span>, <span class="cm-number">8</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">bn1</span> = <span class="cm-variable">nn</span>.<span class="cm-property">BatchNorm2d</span>(<span class="cm-number">64</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">bn2</span> = <span class="cm-variable">nn</span>.<span class="cm-property">BatchNorm2d</span>(<span class="cm-number">128</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">bn3</span> = <span class="cm-variable">nn</span>.<span class="cm-property">BatchNorm2d</span>(<span class="cm-number">256</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">dropout50</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Dropout</span>(<span class="cm-number">0.5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">dropout10</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Dropout</span>(<span class="cm-number">0.1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">fc</span> = <span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">256</span>, <span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">forward</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">bn1</span>(<span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span>(<span class="cm-variable">x</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">bn1</span>(<span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">conv2</span>(<span class="cm-variable">x</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">maxpool</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">dropout10</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">bn2</span>(<span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">conv3</span>(<span class="cm-variable">x</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">bn2</span>(<span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">conv4</span>(<span class="cm-variable">x</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">avgpool</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">dropout10</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">bn3</span>(<span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">conv5</span>(<span class="cm-variable">x</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">bn3</span>(<span class="cm-variable">F</span>.<span class="cm-property">relu</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">conv6</span>(<span class="cm-variable">x</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">globalavgpool</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">dropout50</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable">x</span>.<span class="cm-property">view</span>(<span class="cm-variable">x</span>.<span class="cm-property">size</span>(<span class="cm-number">0</span>), <span class="cm-operator">-</span><span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">fc</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 784px;"></div><div class="CodeMirror-gutters" style="display: none; height: 784px;"></div></div></div></pre><p><span>由于数据集与mnist同为图像分类识别数据集，因此损失函数和优化器与mnist数据集中的保持一致，如下图所示:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">criterion</span> = <span class="cm-variable">nn</span>.<span class="cm-property">CrossEntropyLoss</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">optimizer</span> = <span class="cm-variable">optim</span>.<span class="cm-property">Adam</span>(<span class="cm-variable">net</span>.<span class="cm-property">parameters</span>(), <span class="cm-variable">lr</span>=<span class="cm-number">0.001</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>cifar10_model2在batch_size=100的条件下训练10个epoch之后，测试集正确率大概在80%左右。对于cifar10这样的数据集准确率已经较高了，结果如下图所示:</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200517145130064-725291557.png" referrerpolicy="no-referrer"></p>
    </div>    
        <!--<p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1553"><a class="md-toc-inner" href="#快速入门">快速入门</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1554"><a class="md-toc-inner" href="#1-界面介绍">1. 界面介绍</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1558"><a class="md-toc-inner" href="#2-组件框">2. 组件框</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1561"><a class="md-toc-inner" href="#3-生成和下载代码">3. 生成和下载代码</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1564"><a class="md-toc-inner" href="#4-保存模型">4. 保存模型</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1568"><a class="md-toc-inner" href="#使用说明">使用说明</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1569"><a class="md-toc-inner" href="#1-概述">1. 概述</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1572"><a class="md-toc-inner" href="#2-搭建模型">2. 搭建模型</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1581"><a class="md-toc-inner" href="#3-生成的代码介绍">3. 生成的代码介绍</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1584"><a class="md-toc-inner" href="#4-模型管理">4. 模型管理</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1586"><a class="md-toc-inner" href="#5-相关的注意事项">5. 相关的注意事项</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1594"><a class="md-toc-inner" href="#说明">说明</a></span></p></div>

    <div  id='write'  class = 'is-node first-line-indent'>    
    <p>&nbsp;</p><p><span>VisualPytorch发布域名+双服务器如下：</span></p><p><a href='http://nag.visualpytorch.top/static/' target='_blank' class='url'>http://nag.visualpytorch.top/static/</a><span>      (对应114.115.148.27)</span>
    <p><a href='http://visualpytorch.top/static/' target='_blank' class='url'>http://visualpytorch.top/static/</a><span></span>      (对应39.97.209.22)</span></p></p><h1><a name="快速入门" class="md-header-anchor"></a><span>快速入门</span></h1><h2><a name="1-界面介绍" class="md-header-anchor"></a><span>1. 界面介绍</span></h2><p><span>首先打开网址，进入网站的首页。网站有游客游览模式和用户登录模式，建议先注册登录一个账号，也是十分简便的啦，因为这样可以使用更多的功能。</span></p><p><span>页面头部有三个选项，分别为VisualPytorch, 帮助和联系我们，VisualPytorch就是主页面，可以进行模型的搭建，帮助页面是本网站的简单教程以及相关知识的讲解，在联系我们界面，可以给我们反馈你在使用过程中的遇到的问题，帮助我们进步呀。</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200503123431927-2008737090.gif" referrerpolicy="no-referrer"></p><h2><a name="2-组件框" class="md-header-anchor"></a><span>2. 组件框</span></h2><p><span>在VisualPytorch界面左侧有可选择的网络层，这些层就是用来搭建神经网络模型的基本组件，在网络层的下面还有训练参数配置，主要用于确定模型的全局训练参数。下面给大家简单展示一下如何拖拽和删除这些组件框，以及组件框参数的位置。</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200503123445038-49377170.gif" referrerpolicy="no-referrer"></p><h2><a name="3-生成和下载代码" class="md-header-anchor"></a><span>3. 生成和下载代码</span></h2><p><span>在VisualPytorch界面左上角有生成代码按钮，当你搭建好自己的神经网络模型之后，就可以点击这个按钮，然后会跳转到代码页面，你也就可以看到生成的代码啦，然后再点击下载代码，就可以把代码下载到本地，畅快的玩耍一番啦。</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200503123505464-813892057.gif" referrerpolicy="no-referrer"></p><h2><a name="4-保存模型" class="md-header-anchor"></a><span>4. 保存模型</span></h2><p><span>考虑到也许后续还要用自己搭建过的模型，所以我们实现了保存模型这一功能（贴心的团队，有木有），当你搭建好一个模型之后，可以直接选择保存，然后模型就会保存到你的账号啦，下次你登录还可以查看自己之前的模型。</span></p><p><img src="https://img2020.cnblogs.com/blog/1972898/202005/1972898-20200503123524526-212528083.gif" referrerpolicy="no-referrer"></p><h1><a name="使用说明" class="md-header-anchor"></a><span>使用说明</span></h1><h2><a name="1-概述" class="md-header-anchor"></a><span>1. 概述</span></h2><p><span>我们的网站旨在利用清晰的可视化模型来帮助热爱deep learning的你快速搭建想搭建的模型。</span></p><p><span>目前支持的神经网络层有：reshape层，全连接层，一维卷积层，二维卷积层； 这些层及其涉及的参数的具体含义都与pytorch官方文档里一致。</span></p><h2><a name="2-搭建模型" class="md-header-anchor"></a><span>2. 搭建模型</span></h2><p><span>模型的搭建通过将左侧的各类层模块拖入右侧画布并连线来完成。</span></p><ul><li><span>首先要将左侧的 开始 按钮拖到右侧画布开始模型的搭建，然后一次将你想加入的层模块拖入到右侧画布中，之后点击模块四周的黑点并拖动至其他模块的黑点位置即可完成层模块的连接，支持层模块的并联。</span></li><li><span>在各个层模块中，其中一些层需要填入相应参数，需要参数的层模块在点击之后会弹出该层需要的具体参数，填写之后点击确认即可保存该层参数。参数均有输入限制，若存在不合规范的参数输入在点击确认时会显示错误提示，详细的参数要求及层的功能介绍会在下文中介绍。</span></li><li><span>在确认已经完成模型的搭建并填写完毕相应参数之后，可以点击 生成代码 按钮转到生成模型代码页面，若模型搭建中出现错误则无法正常生成代码并弹出错误提示。同时在完成模型搭建之后，点击 保存 按钮可以将搭建的模型保存在用户的账户中，需要注意的是，只有注册用户拥有权限保存自己搭建的模型，游客不具有保存模型的权限。</span></li></ul><h2><a name="3-生成的代码介绍" class="md-header-anchor"></a><span>3. 生成的代码介绍</span></h2><p><strong><span>main.py</span></strong><span>里的代码主要是涉及全局的参数以及训练部分，目前该部分还有待完善。</span></p><p><strong><span>model.py</span></strong><span>里则主要是搭建的模型代码，整个模型我们封装成了一个类，类名是 NET。</span></p><h2><a name="4-模型管理" class="md-header-anchor"></a><span>4. 模型管理</span></h2><p><span>注册用户拥有保存自己搭建的模型并管理的权限，用户可以通过点击页面上显示的用户名，弹出 模型查看 和 登出 选项，点击模型查看即可进入模型管理的页面，该页面会显示用户曾搭建并保存的所有模型，每个模型都有对应的 查看 和 删除 按钮。点击查看即可进入模型搭建的页面并恢复用户曾保存的模型，用户可以对该模型进行重新编辑。点击删除即可删除相应的模型。</span></p><h2><a name="5-相关的注意事项" class="md-header-anchor"></a><span>5. 相关的注意事项</span></h2><ul><li><span>搭建神经网络模块需要有显示的开始于结束节点。</span></li><li><span>reshape层里如果有多个维度的话，</span><strong><span>不同维度之间需要以英文的逗号分开</span></strong><span>。</span></li></ul><p>&nbsp;</p><h1><a name="说明" class="md-header-anchor"></a><span>说明</span></h1><p><span>本教程部分参考了</span><a href='https://pytorch-cn.readthedocs.io/zh/latest/'><span>PyTorch中文手册</span></a><span>和</span><a href='https://pytorch.org/docs/stable/index.html'><span>PyTorch官方文档</span></a><span>，如果想要更详细深入了解的请访问该手册和文档。</span></p><p><span>若觉得官方文档较难读懂，先看以下个人博客：</span></p><p><a href='https://www.cnblogs.com/RyanSun17373259/p/12575928.html'><span>Pytorch_Part1_简介&amp;张量</span></a></p><p><a href='https://www.cnblogs.com/RyanSun17373259/p/12575945.html'><span>Pytorch_Part2_数据模块</span></a></p><p><a href='https://www.cnblogs.com/RyanSun17373259/p/12575978.html'><span>Pytorch_Part3_模型模块</span></a></p><p><a href='https://www.cnblogs.com/RyanSun17373259/p/12575988.html'><span>Pytorch_Part4_损失函数</span></a></p><p><a href='https://www.cnblogs.com/RyanSun17373259/p/12575993.html'><span>Pytorch_Part5_迭代训练</span></a></p><p><a href='https://www.cnblogs.com/RyanSun17373259/p/12575866.html'><span>Pytorch_Part6_正则化</span></a></p><p><a href='https://www.cnblogs.com/RyanSun17373259/p/12586378.html'><span>Pytorch_Part7_模型使用</span></a></p>
    </div> -->
</body>
<script>
    $("#header").load("../base/header.html");
    //$("#footer").load("base/footer.html");
</script>
<script>
    $(document).ready(function () {
        $('body').scrollspy({target: '#doc-sidebar', offset: 51})

        $('#doc-sidebar').on('activate.bs.scrollspy', function (e) {
            // console.info("每当一个新条目被激活后都将由滚动监听插件触发此事件。")
            $("#navbar").removeClass("in");
        })
    });
</script>
</html>

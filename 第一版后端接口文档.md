功能说明：前端有若干个模块，包括**神经网络层**和**经典模型**可供用户选择，用户根据这些模块来搭建模型。

static里面是需要用户指定的全局变量。

一个数组，每个数组元素对应用户所连接的 一条边，同时记录了两个端点的字段信息，还附加了一个区别于其他端点的id字段和 代表该端点是否是根节点的字段。 （2）调用方法：调用/VisualPytorch/VisualPytorch/ops.py下的main_func(edge_record) 即可，其中，edge_record为（1）中前端传给后端的数据，该函数的返回值为三个字 符串数组，依次为main.py,model.py,ops.py的内容。

只涉及到两种输入方式，包括表单输入类型以及选项类型，与之前相同。

关于输入的词法合法性由前端解决，而语法合法性由后端

例如shape(string)，合法输入为 : 2,2

如果输入3?3则前端报错

如果输入与前一个网络层的输出不匹配，则由后端报错

每个参数规范如下

以in_channel(int):输入通道数 **非0正数**

in_channel为json格式中对应的attribute名

int为数据类型

输入通道数为对应的中文含义，可以忽略也可以在前端中给出

非0正数为对输入数据的要求，如果不符合应在前端报错

# Structure部分规范

## 一、神经网络层及其参数:

### 1、view_layer:reshape层(与之前保持相同)

#### view_layer为json中name,reshape层为网页中显示的名字，下同

参数类型:

shape(string)

用户可以输入多个数字，包括所有非负整数和-1(只有-1是例外),同维度数字之间以英文的“,”分开，例如1,2,3,4,5

### 2、linear_layer:全连接层(与之前保持相同)

参数类型:

in_channel(int):输入通道数  要求为**非0正数**

out_channel(int):输入通道数 要求为**非0正数**

### 3、conv_layer卷积层(删除了之前的1维/2维卷积层)

参数类型:

type:下拉框三选一，选项包括1d/2d/3d

in_channel(int):输入通道数 **非0正数**

out_channel(int):输出通道数 **非0正数**

kernel_size (int) : 卷积核的尺寸 **非零正数** 

stride (int) : 卷积步长 **非零正数** 

padding (int) : 补充0的层数 **非负整数**

### 4、element_wise_add_layer:元素级相加层(与之前保持相同)

无参数

### 5、concatenate_layer:channel维度拼接层(与之前保持相同)

参数类型:

dim(int):拼接维度 **非0正数**

### 6、maxpool_layer:最大池化层(新增，从卷积层分离)

参数类型:

type:下拉框三选一，选项包括1d/2d/3d

kernel_size (int) : 卷积核的尺寸 **非0正数**

stride (int) : 卷积步长 **非0正数**

padding (int) : 补充0的层数 **非负整数**

dilation(int):扩张数 **非0正数**

### 7、avgpool_layer:平均池化层(新增，从卷积层分离)

参数类型:

type:下拉框三选一，选项包括1d/2d/3d

kernel_size (int) : 卷积核的尺寸 **非0正数**

stride (int) : 卷积步长 **非0正数**

padding (int) : 补充0的层数 **非负整数**

ceil_mode:下拉框二选一，ceil/floor

count_include_pad:下拉框二选一,true/false

### 8、activation_layer激活层(新增，从卷积层分离)

参数类型:

type:下拉框，包括ReLU/Sigmoid/tanh/Leaky ReLU/ELU

对不同的激活函数有不同的参数

ReLU：无参数

Sigmoid:无参数

tanh:无参数

Leaky RelU:negative_slope(double)  **非0正实数**

ELU:angle(double) **非0正实数**

### 9、softmax_layer:softmax层(新增，从卷积层分离)

参数类型:

dim(int):计算维度 非0正数

### 10、RNN_layer:递归神经网络(新增网络层)

参数类型:

input_size(int)：输入特征数  **非0正数**

hidden_size（int):隐藏层个数  **非0正数**

num_layers(int):递归层层数 **非0正数**

nonlinearity:二选一,tanh/relu

### 11、LSTM_layer:长周期神经网络(新增网络层)

参数类型:

input_size(int):输入特征数  **非0正数**

hidden_size（int) :隐藏层个数 **非0正数**

num_layers(int):递归层层数  **非0正数**

### 12、BatchNorm_layer:加速层(新增网络层)

参数类型:

type:下拉框三选一，选项包括1d/2d/3d

num_features(int):输入特征数  **非0正数**

### 13、start：开始

无参数 

### 14、end:结束（新增层)

无参数

## 二、static参数

epoch(int)：全数据集训练次数 **非0正数**

learning_rate(double):学习率 **大于0的实数**

batch_size(int):每次训练个数 **非0正数**

optimizer:优化器 下拉框，共包含SGD,Momentum,RmsProp,Adam,Adamax,ASGD

dataset:训练数据集 下拉框，共包含mnist,cifar10,stl10,svhn

ifshuffle：是否打乱数据集 勾选框，默认为勾选，在json中为true,否则为false

platform:运行平台 下拉框，共包含CPU/GPU

loss_func:损失函数 下拉框，共包含MSELoss,CrossEntrophyLoss,L1Loss,NLLLoss,BCELoss

### 三、经典模型选择

1、Lenet

conv_2d->relu->maxpool2d->conv_2d->relu->maxpool2d->linear->relu->linear->relu->linear

(仅作为说明模型结构，无意义，下同)

2、Alexnet

features->classfier

features:conv_2d->relu->maxpool2d->conv2d->relu->maxpool2d->conv2d->relu->conv2d->relu->conv2d->relu->maxpool2d

classfier:linear->relu->linear->relu->linear

3、NIN

conv2d->relu->conv2d->relu->conv2d->relu



这三种模型参数相同，包括:
in_channel(int) 非0正数

out_channel(int) 非0正数

### 四、输入的json格式(structure中)

nets中记录每个独立网络层的结构，nets_conn记录网络层的连通情况,static记录全局变量

```json
structures:{
	"nets":{
		"canvas_%d":#网络层id，从1开始
			{
			  "name":网络层名称(start,view_layer等+Lenet/Alexnet/NIN)，
			  "attribute":{
				"参数":"类型"
				 #对于激活层，根据type导致参数数量不定
			  },
			  "left":"XXXpx",
			   "right":"XXXpx",#记录目的应该是保存模型后能够重新生成之前所画的网络
			}
	},
	'nets_conn':[
		{
			"source":{
			         id:#网络层id,
					 anchor_position:("Bottom"/"Up"/"Left"/"Right"),#箭头连接位置
			        }
			"target":{
			         id:#网络层id,
					 anchor_position:("Bottom"/"Up"/"Left"/"Right"),#箭头连接位置
			        }
					
		}
	],
	"static":{
		"参数":"数值"#共7个参数
	}
	
}
```



## 二、网络模型接口

### 1、NetworkList类

#### （1）获得存储的模型

| 字段              | 内容                            |
| ----------------- | ------------------------------- |
| http请求类型      | GET                             |
| url               | [ip]/api/NeuralNetwork/network/ |
| status（success） | 200                             |
| status（failure） | 400                             |

**返回值示例**

```
[
    {
        "id": 100,
        "creator": -1,
        "structure": "{'network': [{'source': {'id': 'canvas_1', 'name': 'start', 'attribute': {'start': 'true'}}, 'target': {'id': 'canvas_2', 'name': 'view_layer', 'attribute': {'shape': ''}}}], 'static': {'epoch': '', 'learning_rate': '', 'batch_size': ''}}",
        "time": "2019-04-18T07:35:43.036087Z"
    },
    {
        "id": 101,
        "creator": -1,
        "structure": "{'network': [{'source': {'id': 'canvas_1', 'name': 'start', 'attribute': {'start': 'true'}}, 'target': {'id': 'canvas_2', 'name': 'view_layer', 'attribute': {'shape': '4'}}}], 'static': {'epoch': '', 'learning_rate': '', 'batch_size': ''}}",
        "time": "2019-04-18T07:35:48.066113Z"
    }
]
```

#### (2) 保存模型

| 字段              | 内容                            |
| ----------------- | ------------------------------- |
| http请求类型      | POST                            |
| url               | [ip]/api/NeuralNetwork/network/ |
| status（success） | 201                             |
| status（failure） | 400                             |

**data字段**

```
{
    "creator":[用户令牌,未登录默认为-1],
    "structure":[前端的模型]
}
```

### 2、NetworkDetail类

该类用于对后端已存储的网络模型进行一些细节操作。

#### （1）根据id获取模型

| 字段              | 内容                                 |
| ----------------- | ------------------------------------ |
| http请求类型      | GET                                  |
| url               | [ip]/api/NeuralNetwork/network/[id]/ |
| status（success） | 200                                  |
| status（failure） | 400                                  |

**返回值示例**

```
{
        "id": 101,
        "creator": -1,
        "structure": "{'network': [{'source': {'id': 'canvas_1', 'name': 'start', 'attribute': {'start': 'true'}}, 'target': {'id': 'canvas_2', 'name': 'view_layer', 'attribute': {'shape': '4'}}}], 'static': {'epoch': '', 'learning_rate': '', 'batch_size': ''}}",
        "time": "2019-04-18T07:35:48.066113Z"
    }
```

#### （2）根据id修改模型

| 字段              | 内容                                 |
| ----------------- | ------------------------------------ |
| http请求类型      | PUT                                  |
| url               | [ip]/api/NeuralNetwork/network/[id]/ |
| status（success） | 200                                  |
| status（failure） | 400                                  |

**data字段**

```
{
    "creator":[用户令牌,未登录默认为-1],
    "structure":[前端的模型]
}
```

#### （3）根据id删除模型

| 字段              | 内容                                 |
| ----------------- | ------------------------------------ |
| http请求类型      | DELETE                               |
| url               | [ip]/api/NeuralNetwork/network/[id]/ |
| status（success） | 200                                  |
| status（failure） | 400                                  |

### 3、代码生成接口

| 字段              | 内容                            |
| ----------------- | ------------------------------- |
| http请求类型      | POST                            |
| url               | [ip]/api/NeuralNetwork/getcode/ |
| status（success） | 200                             |
| status（failure） | 400                             |

**data字段**

```
{
    "creator":[用户令牌,未登录默认为-1],
    "structure":[前端的模型]
}
```

**返回值**

```
{
    "Main":[Main模块代码],
    "Model":[Model模块代码],
    "Ops":[Ops模块代码]
}
```

